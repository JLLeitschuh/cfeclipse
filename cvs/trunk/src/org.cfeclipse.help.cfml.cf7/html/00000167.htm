<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Exercise 1: Enabling users to browse trip details</title>
</head>
<body>
<p align="right"><p align="right"><a href="00000166.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000168.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Exercise 1: Enabling users to browse trip details</h1>
<p>In <a href="00000148.htm#1181359">Lesson 6: Creating a Main Application Page</a>, you added buttons to the Trip Detail page to browse records in the database. In this exercise, you build the action pages that implement the actions for these buttons.</p>
<p>To enable browsing, you build the Navigation Action page. This page determines which trip record appears on the Trip Detail page after the user clicks one of the navigation buttons. There is no HTML output displayed from this action page. Instead, this page uses dynamic SQL to identify the <code>tripID</code> that must appear on the Trip Detail page. In this dynamic SQL statement, the proper <code>tripID</code> is passed as a parameter to the URL, and then redirects the <code>tripID</code> to the Trip Detail page.</p>
<h2><a name="wp1152558"></a>Using dynamic SQL to browse the Trips table</h2>
<p>The <code>tripID</code> uniquely identifies a trip in the Trips table. In <a href="00000148.htm#1181359">Lesson 6: Creating a Main Application Page</a>, you displayed the Trip Detail page for a trip by passing the ID as a parameter of the URL. For example, you would use the following URL to display the detail information for a trip with the ID of 20: </p>
<pre>http://localhost/cfdocs/getting_started/my_app/tripdetail.cfm?ID=20
</pre><p>The main objective of the Navigation Action page (navigationaction.cfm) is to navigate to the Trip Detail page using a URL that includes the correct <code>tripID</code> based on the navigation button clicked. Because trips are added and later deleted, trips might not be ordered sequentially by ID. There can be missing IDs where trips were deleted. For example, if the current <code>tripID</code> is 10 and the user clicks the Next navigation button, the <code>tripID</code> of the next trip might not be 11; it could be 14.</p>
<p>To retrieve the proper <code>tripID</code>, you must query the database to find out what the next (or previous, first, or last) ID is, based on the current <code>tripID</code>. The navigation action page uses dynamic SQL to build a query to find the appropriate ID to use.</p>
<p>In <a href="00000127.htm#1141005">Lesson 4: Building Dynamic Queries</a>, you used ColdFusion string manipulation to construct the proper SQL SELECT WHERE clause. In this lesson, you use a similar approach to build the WHERE clause for navigation. Additionally, you use the proper ORDER BY clause to select the correct trip row from the trips table.</p>
<p>For example, if the current <code>tripID</code> equals 6, the following table identifies the proper SQL statement based on the navigation button that the user clicked:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Navigation button
    </th>
    <th>
SQL statement to navigate to correct trip ID
    </th>
    <th>
SQL statement description
    </th>
  </tr>
  <tr>
    <td>
<p>First Row</p>
    </td>
    <td>
<p>SELECT tripID FROM trips</p>
<p>ORDER BY tripID</p>
    </td>
    <td>
<p>Returns the list of all <code>tripIDs</code> in ascending (1,2,3...) order.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Previous Row</p>
    </td>
    <td>
<p>SELECT tripID FROM trips</p>
<p>WHERE tripID &lt; 6</p>
<p>ORDER BY tripID DESC</p>
    </td>
    <td>
<p>Returns the list of all <code>tripIDs</code> less than 6 in descending (5,4,3...) order.</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Next Row</p>
    </td>
    <td>
<p>SELECT tripID FROM trips</p>
<p>WHERE tripID &gt; 6</p>
<p>ORDER BY tripID </p>
    </td>
    <td>
<p>Returns the list of all <code>tripIDs</code> greater than 6 in ascending (7,8,9...) order.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Last Row</p>
    </td>
    <td>
<p>SELECT tripID FROM trips<br />ORDER BY tripID DESC</p>
    </td>
    <td>
<p>Returns the list of all <code>tripIDs</code> in descending (99,98,97...) order.</p>
    </td>
  </tr>
</table>

<p>To properly build the SQL SELECT statement for previous and next row navigation, you must know the current <code>tripID</code>. This is the reason for using the hidden input tag <code>RecordID</code> on the Trip Detail page. You can use the form variable <code>#Form.RecordID#</code> in the Navigation Action page for building the proper test in the WHERE clause of the SQL SELECT statement. </p>
<h2><a name="wp1174779"></a>Limiting the number of result rows</h2>
<p>Each of the SQL statements in the preceding table returns a result set of trips rows. The result set can range from zero to any number of rows. The Navigation Action page must limit the result set count to 1, because only the initial row in the result set appears on the Trip Detail page. </p>
<p>ColdFusion provides the <code>maxRows</code> attribute for the <code>cfquery</code> tag for this purpose. This attribute limits the number of result rows returned from the database. To show only a single row at a time in the Trip Detail page, set <code>maxRows</code> to 1. </p>
<h4>To build the Navigation Action page:</h4>
<ol>
<li>
   Create a blank file.
</li>
<li>
   Enter the following code in the blank file:
<pre>
&lt;!---			NAVIGATION BUTTONS 			---&gt;
	&lt;cfquery name=&quot;TripQuery&quot; datasource=&quot;CompassTravel&quot; maxrows=&quot;1&quot;&gt;
		SELECT tripID FROM trips			
		&lt;cfif IsDefined(&quot;Form.btnPrev.X&quot;)&gt;
			WHERE tripID &lt; #Form.RecordID#
			ORDER BY tripID DESC		
		&lt;cfelseif IsDefined(&quot;Form.btnNext.X&quot;)&gt;
			WHERE tripID &gt; #Form.RecordID#
			ORDER BY tripID		
		&lt;cfelseif IsDefined(&quot;Form.btnFirst.X&quot;)&gt;
			ORDER BY tripID		
		&lt;cfelseif IsDefined(&quot;Form.btnLast.X&quot;)&gt;
			WHERE tripID &gt; #Form.RecordID#
			ORDER BY tripID DESC
		&lt;/cfif&gt;
	&lt;/cfquery&gt;
	&lt;cfif TripQuery.RecordCount is 1&gt;
		&lt;cflocation url=&quot;tripdetail.cfm?ID=#TripQuery.tripID#&quot;&gt;
	&lt;cfelse&gt;
		&lt;cflocation url=&quot;tripdetail.cfm?ID=#Form.RecordID#&quot;&gt;
	&lt;/cfif&gt;
</pre>
</li>
<li>
   Save the file as navigationaction.cfm in the my_app directory.
</li>
</ol>
<p><strong>Note: </strong>In previous lessons, you adhered to good coding practices by putting queries in ColdFusion components. To optimize performance, and because the Navigation Action page contains only a query, the page is a ColdFusion page rather than a CFC. For more information about code reuse, see <a href="00000993.htm#1101532">Creating ColdFusion Elements</a> in <i>ColdFusion MX Developer's Guide</i>.</p><h4><a name="wp1175346"></a>Reviewing the code</h4>
<p>The following table describes the code used to process the navigation button requests:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code 
    </th>
    <th>
Explanation
    </th>
  </tr>
  <tr>
    <td>
<pre>&lt;cfquery<br />   name=&quot;TripQuery&quot;<br />   dataSource=&quot;CompassTravel&quot; <br />   maxRows=1&gt;
</pre>    </td>
    <td>
<p>The <code>cfquery</code> tag identifies that a query named TripQuery is executed against the CompassTravel data source. The number of rows returned cannot exceed 1 (<code>maxRows</code>=1).</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>SELECT tripID FROM trips
</pre>    </td>
    <td>
<p>The SQL SELECT statement will always start with &quot;SELECT tripID FROM trips.&quot;</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cfif IsDefined(&quot;Form.btnPrev.X&quot;)&gt;
   WHERE tripID &lt; #Form.RecordID#
   ORDER BY tripID DESC

&lt;cfelseif IsDefined(&quot;Form.btnNext.X&quot;)&gt;
   WHERE tripID &gt; #Form.RecordID#
   ORDER BY tripID

&lt;cfelseif IsDefined(&quot;Form.btnFirst.X&quot;)&gt;
   ORDER BY tripID

&lt;cfelseif IsDefined(&quot;Form.btnLast.X&quot;)&gt;
   WHERE tripID &gt; #Form.RecordID#
   ORDER BY tripID DESC

&lt;/cfif&gt;

&lt;/cfquery&gt;
</pre>    </td>
    <td>
<p>The <code>cfif</code> tag checks whether the user pressed a navigation button on the browse page. The <code>X</code> property is checked because the buttons on the detail page use image type HTML input tags. The <code>X</code> property is a mouse offset that gets sent when the user clicks a graphic button.</p>
<p>&#160;</p>
<p>The WHERE and ORDER BY clauses vary depending on the navigation button that the user clicks.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;cfif TripQuery.RecordCount is 1&gt;
&lt;cflocation url=&quot;tripdetail.cfm?RecordID=#TripQuery.tripID#&quot;&gt;
&lt;cfelse&gt;
&lt;cflocation url=&quot;tripdetail.cfm?RecordID=#Form.RecordID#&quot;&gt;
&lt;/cfif&gt;
</pre>    </td>
    <td>
<p>The <code>cfif</code> tag checks to see whether the query returned a row to display. If it did, that <code>tripID</code> is used to form a URL to navigate to using the <code>cflocation</code> tag. If the query returned no rows, it navigates back to the detail page with the current record ID, which passed in the hidden form variable <code>RecordID</code>.</p>
    </td>
  </tr>
</table>

<h4>To test the navigation:</h4>
<ol>
<li>
   View the tripdetail.cfm page from the my_app directory in a browser.
</li>
<li>
   Click the Next Row button.
<p>The Trip Detail page shows information about the second trip.</p>
</li>
<li>
   Click the Previous Row button.
<p>The Trip Detail page shows information about the first trip.</p>
</li>
<li>
   Click the Last Row button.
<p>The Trip Detail page shows information about the last trip. </p>
</li>
<li>
   Click the First Row button.
<p>The Trip Detail page shows information about the first trip.</p>
</li>
</ol>


<hr />
<p align="right"><p align="right"><a href="00000166.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000168.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000167.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



