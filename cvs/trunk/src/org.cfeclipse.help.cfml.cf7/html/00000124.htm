<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Exercise 5: Creating additional queries</title>
</head>
<body>
<p align="right"><p align="right"><a href="00000123.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000125.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Exercise 5: Creating additional queries</h1>
<p>In this exercise, you will improve the Trip List page to make it easier for the Compass Travel agents to locate trips. You must make the following improvements:</p>
<ul>
<li>
   Sort the trip names in alphabetical order.
</li>
<li>
   Display the departure date, return date, and price for each trip.
</li>
<li>
   Develop a Budget Trip List report that identifies trips that are priced $1500 or less.
</li>
</ul>
<p>You could modify the existing query; however, you may need to use that query in the future. Instead, you can create an additional method in the gettrips.cfc component with a query that meets the preceding requirements. You can then call the new methods with the enhanced query from the triplisting.cfm page. Display the triplisting.cfm page in the browser after each step to ensure that the corresponding requirement was met. </p>
<p>To modify the application, you must:</p>
<ul>
<li>
   Create the query that meets the requirements.
</li>
<li>
   Invoke the method that contains the query.
</li>
<li>
   Display the results.
</li>
</ul>
<h2><a name="wp1197937"></a>Creating the query</h2>
<p>To continue writing structured, reusable code, you create the query in a method in the existing CFC.</p>
<h4>To create a method with enhanced query results:</h4>
<ol>
<li>
   Open the gettrips.cfc file.
</li>
<li>
   Enter the following code just before the closing <code>cfcomponent</code> tag, or do the steps in the <a href="00000124.htm#1197877">Let Dreamweaver do it</a> section.
<pre>
&lt;cffunction name=&quot;getBudgetTrips&quot; displayName=&quot;Budget trip list&quot; 
	hint=&quot;List trips under $1500 alphabetically&quot; 
	access=&quot;public&quot; 
	returnType=&quot;query&quot; 
	output=&quot;false&quot;&gt;
	&lt;cfquery name=&quot;budgetTrips&quot; datasource=&quot;CompassTravel&quot;&gt;
		SELECT tripName, departureDate, returnDate, price
		FROM trips 
		WHERE price &lt;= 1500
		ORDER BY tripName
	&lt;/cfquery&gt;
	&lt;cfreturn budgetTrips&gt;
	&lt;/cffunction&gt;
</pre>
</li>
<li>
   Save the file.
</li>
</ol>
<h4><a name="wp1197838"></a>Let Dreamweaver do it</h4>
<p>You can use the Dreamweaver Extensions to create a CFC query and invoke the method that contains the query from the triplisting.cfm page.</p>
<h4>To create the enhanced CFC query in Dreamweaver:</h4>
<ol>
<li>
   Open the gettrips.cfc file and position the pointer before the closing <code>cfcomponent</code> tag.
</li>
<li>
   Click the Bindings tab.
</li>
<li>
   Click the + button.
</li>
<li>
   Select Recordset (Query).
</li>
<li>
   In the Name text box, enter <strong>budgetTrips</strong>.
</li>
<li>
   Click the New Function button.
</li>
<li>
   In the New function name text box, enter <strong>getBudgetTrips</strong>.
</li>
<li>
   Click OK.
</li>
<li>
   In the Data Source list, select CompassTravel.
</li>
<li>
   In the Table list, select trips.
</li>
<li>
   Click the Selected button.
</li>
<li>
   Select tripName, departureDate, returnDate, and price from the list of columns.
</li>
<li>
   In the Filter section, select price, select &lt; from the list of operators, select Entered value, and enter <strong>1500</strong> in the text box.
</li>
<li>
   In the Sort section, select tripName, and select Ascending.
</li>
<li>
   Click OK.
</li>
<li>
   Save the file.
</li>
</ol>
<h2><a name="wp1197949"></a>Invoking the new method</h2>
<p>To use the new query, you invoke the method that contains the query.</p>
<h4>To invoke the new method with the enhanced query:</h4>
<ol>
<li>
   Open the triplisting.cfm file.
</li>
<li>
   Modify the following code, or do the steps listed in the <a href="00000124.htm#1197877">Let Dreamweaver do it</a> section.
<pre>
&lt;cfinvoke
 component=&quot;cfdocs.getting_started.my_app.components.gettrips&quot;
 method=&quot;getBudgetTrips&quot;
 returnvariable=&quot;budgetTrips&quot;&gt;
&lt;/cfinvoke&gt;
</pre>
</li>
<li>
   Save the file.
</li>
</ol>
<h4><a name="wp1197877"></a>Let Dreamweaver do it</h4>
<p>You can use the Dreamweaver Extensions to create the CFC query and invoke the method that contains the query from the triplisting.cfm page.</p>
<h4>To invoke the enhanced CFC query in Dreamweaver:</h4>
<ol>
<li>
   Delete the <code>cfinvoke</code> code block.
</li>
<li>
   Click the Components tab.
</li>
<li>
   Click the + button next to cfdocs.getting_started.my_app.components, and click the + button next to gettrips.
</li>
<li>
   Select query getBudgetTrips and drag it to the top of the file.
</li>
<li>
   Change the value of the <code>returnvariable</code> to be the name of the query, budgetTrips, as follows:
<pre>
returnvariable=&quot;budgetTrips&quot;
</pre>
</li>
<li>
   Save the file.
</li>
</ol>
<h2><a name="wp1197868"></a>Displaying the results</h2>
<p>To display the results of the new query, you refer to the new query in the <code>cfoutput</code> block and include all the columns that you want to display.</p>
<h4>To display the results of the enhanced query</h4>
<ol>
<li>
   Change the output block in the triplisting.cfm file to output all three selected fields from the enhanced query, as follows:
<pre>
&lt;cfoutput query=&quot;budgetTrips&quot;&gt;
	#tripName# 
	departs: #departureDate# 
	returns: #returnDate# 
	price: #price#&lt;BR&gt;
&lt;/cfoutput&gt;
</pre>
</li>
<li>
   Change the heading tag in the triplisting.cfm file from <code>&lt;h1&gt;Trip List&lt;/h1&gt; </code>to <code>&lt;h1&gt;Budget Trip List&lt;/h1&gt;</code>.
</li>
<li>
   Save both the triplisting.cfm file and the gettrips.cfc file.
</li>
<li>
   View the triplisting.cfm page in a browser and verify that all the new requirements were met. The revised TripListing.cfm page looks like this:
<p><br />
<img src="images/budget_2.jpg" alt="This image shows a picture of the revised unformatted Budget Trip List page." border="0" hspace="0" vspace="0"/>
<br />
</p>
<p>The dates and prices in the preceding listing are not formatted. In <a href="00000148.htm#1181359">Lesson 6: Creating a Main Application Page</a>, you will enhance the look of this page.</p>
</li>
</ol>


<hr />
<p align="right"><p align="right"><a href="00000123.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000125.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000124.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



