<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Using request and response headers</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001552.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001554.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Using request and response headers</h1>
<p>ColdFusion&#160;MX includes a set of functions that enable your web service to get and set request and response headers. You use these functions to retrieve the response headers from a web service request and to create SOAP headers in a request that has the <code>mustUnderstand</code> attribute set to be True.</p>
<p>You typically use different functions in web services clients and in the web service CFC, itself:</p>
<p><strong>In the client</strong>:</p>
<ul>
<li>
   <a href="00000379.htm#5050827"><code>AddSOAPRequestHeader</code></a>, called before the request to set a SOAP header.
</li>
<li>
   <a href="00000496.htm#5054369"><code>GetSOAPResponseHeader</code></a>, called after the request to retrieve a SOAP header.
</li>
</ul>
<p><strong>In the web service CFC:</strong></p>
<ul>
<li>
   <a href="00000531.htm#5052211"><code>IsSOAPRequest</code></a>, called to determine whether the CFC method is being called as a web service.
</li>
<li>
   <a href="00000494.htm#5054295"><code>GetSOAPRequestHeader</code></a>, called to retrieve a SOAP header set by the client.
</li>
<li>
   <a href="00000380.htm#5050841"><code>AddSOAPResponseHeader</code></a>, called to set a SOAP header that is returned to the client.
</li>
</ul>
<p><strong>Note: </strong>When used in a CFC, you can only use these functions in CFC methods if they are being used as web services. Use the <code>IsSOAPRequest</code> function to determine whether the CFC method is being called as a web service.</p><p>The following example CFM page uses the <code>AddSOAPRequestHeader</code>, <code>getSOAPRequest</code>, and <code>GetSOAPResponse</code> functions:</p>
<pre>&lt;cfsavecontent variable=&quot;my_xml&quot;&gt;
  &lt;Request xmlns=&quot;http://www.oasis-open.org/asap/0.9/asap.xsd&quot;&gt;
    &lt;SenderKey&gt;ss&lt;/SenderKey&gt;
    &lt;ReceiverKey&gt;zz&lt;/ReceiverKey&gt;
    &lt;ResponseRequired&gt;Yes&lt;/ResponseRequired&gt;
    &lt;RequestID&gt;id&lt;/RequestID&gt;
  &lt;/Request&gt;
&lt;/cfsavecontent&gt;
&lt;cfset xml_obj = xmlparse(my_xml)&gt;

&lt;cfscript&gt;
  ws = CreateObject(&quot;webservice&quot;, &quot;http://localhost:8500/soapexamples/HeaderFuncs.cfc?WSDL&quot;);
  addSOAPRequestHeader(ws, &quot;http://www.cfdevguide.com/&quot;, &quot;testrequestheader&quot;, &quot;#xml_obj#&quot;);
&lt;/cfscript&gt;

&lt;cfscript&gt;
  ret=ws.showSOAPHeaders();
  inxml = getSOAPRequest(ws);
  outxml = getSOAPResponse(ws);
&lt;/cfscript&gt;

&lt;cfoutput&gt;
&lt;h2&gt;Return Value&lt;/h2&gt;
&lt;!--- This is XML, so use HTMLCodeFormat. ---&gt;
The return value was #ret#
&lt;h2&gt;Complete Request XML&lt;/h2&gt;
#htmlcodeformat(inxml)#
&lt;h2&gt;Complete Response XML&lt;/h2&gt;
#htmlcodeformat(outxml)#
&lt;/cfoutput&gt;
</pre><p>The following example CFC uses the <code>IsSOAPRequest</code> and <code>AddSOAPResponseHeader</code> functions:</p>
<pre>&lt;cfcomponent&gt;
  &lt;cffunction 
     name = &quot;showSOAPHeaders&quot; 
     returnType = &quot;string&quot; 
     output = &quot;no&quot;
     access = &quot;remote&quot;
    hint=&quot;After calling this function, use GetSOAPRequest and GetSOAPResponse to view headers&quot;&gt;
   &lt;cfset var xml_obj = &quot;&quot;&gt;
   &lt;cfset var ret = &quot;&quot;&gt;

    &lt;cfif IsSOAPRequest()&gt;
      &lt;!--- Define a response header ---&gt;
      &lt;cfsavecontent variable=&quot;response_xml&quot;&gt;
         &lt;ThisResponseHeader xmlns=&quot;http://www.cfdevguide.com&quot;&gt;
           &lt;CreatedDateTime&gt;&lt;cfoutput&gt;#now()#&lt;/cfoutput&gt;&lt;/CreatedDateTime&gt;
           &lt;ExpiresInterval&gt;6000&lt;/ExpiresInterval&gt;
         &lt;/ThisResponseHeader&gt;
      &lt;/cfsavecontent&gt;
      &lt;cfset xml_obj = xmlparse(response_xml)&gt;
      &lt;!--- Add the response header ---&gt;
      &lt;cfscript&gt;
        addSOAPResponseHeader(&quot;http://www.cfdevguide.com/&quot;, &quot;testresponseheader&quot;, &quot;#xml_obj#&quot;);
        ret = &quot;Invoked as a web service. Use GetSOAPRequest and GetSOAPResponse to view headers.&quot;;
     &lt;/cfscript&gt;
    &lt;cfelse&gt;
      &lt;cfset ret = &quot;Not invoked as a web service&quot;&gt;
    &lt;/cfif&gt;
    &lt;cfreturn ret&gt;
  &lt;/cffunction&gt;
&lt;/cfcomponent&gt;
</pre>

<hr />
<p align="right"><p align="right"><a href="00001552.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001554.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001553.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



