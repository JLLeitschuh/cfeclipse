<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>cfquery</title>
</head>
<body>
<p align="right"><p align="right"><a href="00000315.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000317.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>cfquery</h1>
<h4><a name="wp1355825"></a>Description</h4>
<p>Passes queries or SQL statements to a data source.</p>
<p>Macromedia recommends that you use the <code>cfqueryparam</code> tag within every <code>cfquery</code> tag, to help secure your databases from unauthorized users. For more information, see Security Bulletin ASB99-04, &quot;Multiple SQL Statements in Dynamic Queries,&quot; in the Macromedia Security Zone, <a href="http://www.macromedia.com/devnet/security/security_zone/asb99-04.html" target="mm_window">www.macromedia.com/devnet/security/security_zone/asb99-04.html</a>, and <a href="00001252.htm#1127430">Accessing and Retrieving Data</a> in <i>ColdFusion MX Developer's Guide</i>.</p>
<h4><a name="wp1957866"></a>Category</h4>
<p><a href="00000198.htm#2459589">Database manipulation tags</a></p>
<h4><a name="wp1102318"></a>Syntax</h4>
<pre>&lt;cfquery <br />   name = &quot;query_name&quot;<br />   dataSource = &quot;ds_name&quot;<br />   dbtype = &quot;query&quot;<br />   username = &quot;username&quot;<br />   password = &quot;password&quot;<br />   maxRows = &quot;number&quot;<br />   blockFactor = &quot;blocksize&quot;<br />   timeout = &quot;seconds&quot;<br />   cachedAfter = &quot;date&quot; <br />   cachedWithin = &quot;timespan&quot; <br /><br />   <i>Either of the following:<br /></i>      debug = &quot;yes&quot; or &quot;no&quot;<br />   or:<br />      debug<br />&gt;<br />result = &quot;result_name&quot;<br />&lt;/cfquery&gt;
</pre><h4><a name="wp1957824"></a>See also</h4>
<p><a href="00000280.htm#1100472"><code>cfinsert</code></a>, <a href="00000313.htm#1102102"><code>cfprocparam</code></a>, <a href="00000314.htm#1102246"><code>cfprocresult</code></a>, <a href="00000317.htm#1102474"><code>cfqueryparam</code></a>, <a href="00000338.htm#2607555"><code>cfstoredproc</code></a>, <a href="00000346.htm#1104164"><code>cftransaction</code></a>, <a href="00000350.htm#1104662"><code>cfupdate</code></a>; <a href="00001128.htm#1173446">Optimizing database use</a> in <a href="00001102.htm#1101532">Designing and Optimizing a ColdFusion&#160;Application</a> and Chapters 19-22 in <i>ColdFusion MX Developer's Guide</i></p>
<h4><a name="wp2368236"></a>History</h4>
<p>ColdFusion&#160;MX&#160;7:</p>
<ul>
<li>
   Added the <code>result</code> attribute for specifying an alternate name for the structure that holds the result variables.
</li>
<li>
   Added result variables for the SQL statement executed (<code>sql</code>), the number of records returned (<code>recordcount</code>), whether the query was cached (<code>cached</code>), an array of <code>cfqueryparam</code> values (<code>sqlparameters</code>), and the list of columns in the returned query (<code>columnlist</code>).
</li>
</ul>
<p>ColdFusion&#160;MX:</p>
<ul>
<li>
   Changed Query of Queries behavior: it now supports a larger subset of standard SQL.
</li>
<li>
   Changed dot notation support: ColdFusion now supports dot notation within a record set name. ColdFusion interprets such a name as a structure. 
</li>
<li>
   Deprecated the <code>connectString</code>, <code>dbName</code>, <code>dbServer</code>, <code>provider</code>, <code>providerDSN</code>, and <code>sql</code> attributes, and all values of the <code>dbtype</code> attribute except <code>query</code>. They do not work, and might cause an error, in releases later than ColdFusion 5. 
</li>
<li>
   New query object variable: <code>cfquery.ExecutionTime.</code>
</li>
<li>
   No longer supports native drivers. It now uses JDBC (and ODBC-JDBC bridge) for database connectivity.
</li>
</ul>
<h4><a name="wp1426796"></a>Attributes</h4>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Attribute
    </th>
    <th>
Req/Opt
    </th>
    <th>
Default
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<p>name</p>
    </td>
    <td>
<p>Required</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Name of query. Used in page to reference query record set. Must begin with a letter. Can include letters, numbers, and underscores. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>dataSource</p>
    </td>
    <td>
<p>Required unless dbtype=query.</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Name of data source from which query gets data. You must specify either <code>dbtype</code> or <code>dataSource</code>.</p>
    </td>
  </tr>
  <tr>
    <td>
<p>dbtype</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Use this value to specify the results of a query as input. You must specify either <code>dbtype</code> or <code>dataSource</code>.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>username</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Overrides username in data source setup.</p>
    </td>
  </tr>
  <tr>
    <td>
<p>password</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Overrides password in data source setup.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>maxRows</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>-1 (All)</p>
    </td>
    <td>
<p>Maximum number of rows to return in record set.</p>
    </td>
  </tr>
  <tr>
    <td>
<p>blockFactor</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>1</p>
    </td>
    <td>
<p>Maximum rows to get at a time from server. Range: 1 - 100. Might not be supported by some database systems.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>timeout</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Maximum number of seconds that each action of a query is permitted to execute before returning an error. The cumulative time may exceed this value.</p>
<p>For JDBC statements, ColdFusion sets this attribute. For other drivers, check driver documentation.</p>
    </td>
  </tr>
  <tr>
    <td>
<p>cachedAfter</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Date value (for example, April 16, 1999, 4-16-99). If date of original query is after this date, ColdFusion uses cached query data. To use cached data, current query must use same SQL statement, data source, query name, user name, password. </p>
<p>A date/time object is in the range 100 AD-9999 AD.</p>
<p>When specifying a date value as a string, you must enclose it in quotation marks.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>cachedWithin</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Timespan, using the <a href="00000435.htm#1102715"><code>CreateTimeSpan</code></a> function. If original query date falls within the time span, cached query data is used. <code>CreateTimeSpan</code> defines a period from the present, back. Takes effect only if query caching is enabled in the Administrator. </p>
<p>To use cached data, the current query must use the same SQL statement, data source, query name, user name, and password. </p>
    </td>
  </tr>
  <tr>
    <td>
<p>debug</p>
    </td>
    <td>
<p>Optional; value and equals sign may be omitted</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<ul>
<li>
   Yes, or if omitted: if debugging is enabled, but the Administrator Database Activity option is not enabled, displays SQL submitted to datasource and number of records returned by query. 
</li>
<li>
   No: if the Administrator Database Activity option is enabled, suppresses display.
</li>
</ul>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>result</p>
    </td>
    <td>
<p>Optional</p>
    </td>
    <td>
<p>&#160;</p>
    </td>
    <td>
<p>Specifies a name for the structure in which <code>cfquery</code> returns the result variables. For more information, see the Usage section .</p>
    </td>
  </tr>
</table>

<h4><a name="wp1102362"></a>Usage</h4>
<p>Use this tag to execute a SQL statement against a ColdFusion data source. Although you can use the <code>cfquery</code> tag to execute any SQL Data Definition Language (DDL) or Data Manipulation Language (DML) statement, you typically use it to execute a SQL SELECT statement.</p>
<p><strong>Note: </strong>To call a stored procedure, use the <a href="00000338.htm#2607555">cfstoredproc</a> tag.</p><p>This tag creates a query object, providing this information in query variables:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Variable name
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre><i>query_name</i>.currentRow
</pre>    </td>
    <td>
<p>Current row of query that <code>cfoutput</code> is processing.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre><i>query_name</i>.columnList
</pre>    </td>
    <td>
<p>Comma-delimited list of the query columns.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre><i>query_name</i>.RecordCount
</pre>    </td>
    <td>
<p>Number of records (rows) returned from the query.</p>
    </td>
  </tr>
</table>

<p>The <code>cfquery</code> tag also returns the following result variables in a structure. You can access these variables with a prefix of the name you specified in the <code>result</code> attribute. For example, if you assign the name <code>myResult</code> to the <code>result</code> attribute, you would retrieve the name of the SQL statement that was executed by accessing <code>#myResult.sql#</code>. The <code>result</code> attribute provides a way for functions or CFCs that are called from multiple pages, possibly at the same time, to avoid overwriting results of one call with another.</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Variable name
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre><i>result_name</i>.sql
</pre>    </td>
    <td>
<p>The SQL statement that was executed.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre><i>result_name</i>.recordcount
</pre>    </td>
    <td>
<p>Current row of query that <code>cfoutput</code> is processing.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre><i>result_name</i>.cached
</pre>    </td>
    <td>
<p><code>True</code> if the query was cached; <code>False</code> otherwise.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre><i>result_name</i>.sqlparameters
</pre>    </td>
    <td>
<p>An ordered Array of <code>cfqueryparam</code> values.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre><i>result_name</i>.columnList
</pre>    </td>
    <td>
<p>Comma-delimited list of the query columns.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre><i>result_name</i>.ExecutionTime
</pre>    </td>
    <td>
<p>Cumulative time required to process the query.</p>
    </td>
  </tr>
</table>

<p>You can cache query results and execute stored procedures. For information about this and about displaying <code>cfquery</code> output, see <i>ColdFusion MX Developer's Guide</i>. </p>
<p>Because the <code>timeout</code> attribute only affects the maximum time for each suboperation of a query, the cumulative time may exceed its value. To set a timeout for a page that might get a very large result set, set the Administrator &gt; Server Settings &gt; Timeout Requests option to an appropriate value or use the RequestTimeout attribute of the <code>cfsetting</code> tag (for example, <code>&lt;cfsetting</code> <code>requestTimeout=&quot;300&quot;&gt;</code>).</p>
<p>The Caching page of the ColdFusion MX Administrator specifies the maximum number of cached queries. Setting this value to 0 disables query caching.</p>
<p>You cannot use ColdFusion reserved words as query names. </p>
<p>You cannot use SQL reserved words as variable or column names in a Query of Queries, unless they are escaped. The escape character is the bracket []; for example:</p>
<pre>SELECT [count] FROM MYTABLE. 
</pre><p>For a list of reserved keywords in ColdFusion MX, see <a href="00001278.htm#1165025">Escaping reserved keywords</a> in <a href="00001263.htm#1181595">Using Query of Queries</a> in <i>ColdFusion MX Developer's Guide</i>.</p>
<h4><a name="wp1102394"></a>Example</h4>
<pre>&lt;!--- This example shows the use of CreateTimeSpan with CFQUERY ------&gt;
&lt;!--- to cache a record set. Define startrow and maxrows to ----&gt;
&lt;!--- facilitate &#39;next N&#39; style browsing. ----&gt;
&lt;cfparam name=&quot;MaxRows&quot; default=&quot;10&quot;&gt;
&lt;cfparam name=&quot;StartRow&quot; default=&quot;1&quot;&gt;
&lt;!--------------------------------------------------------------------
Query database for information if cached database information has
not been updated in the last six hours; otherwise, use cached data.
---------------------------------------------------------------------&gt;
&lt;cfquery 
name=&quot;GetParks&quot; datasource=&quot;cfdocexamples&quot; 
cachedwithin=&quot;#CreateTimeSpan(0, 6, 0, 0)#&quot;&gt;
SELECT PARKNAME, REGION, STATE
FROM Parks
ORDER BY ParkName, State
&lt;/cfquery&gt;
&lt;!--- Build HTML table to display query. -------------------------&gt;
&lt;table cellpadding=&quot;1&quot; cellspacing=&quot;1&quot;&gt;
   &lt;tr&gt;
      &lt;td bgcolor=&quot;f0f0f0&quot;&gt;
         &amp;nbsp;
      &lt;/td&gt;
      &lt;td bgcolor=&quot;f0f0f0&quot;&gt;
         &lt;b&gt;&lt;i&gt;Park Name&lt;/i&gt;&lt;/b&gt;
      &lt;/td&gt;
      &lt;td bgcolor=&quot;f0f0f0&quot;&gt;
         &lt;b&gt;&lt;i&gt;Region&lt;/i&gt;&lt;/b&gt;
      &lt;/td&gt;
      &lt;td bgcolor=&quot;f0f0f0&quot;&gt;
         &lt;b&gt;&lt;i&gt;State&lt;/i&gt;&lt;/b&gt;
      &lt;/td&gt;
   &lt;/tr&gt;
&lt;!--- Output the query and define the startrow and maxrows parameters. 
Use the query variable CurrentCount to keep track of the row you 
are displaying. ------&gt;
&lt;cfoutput query=&quot;GetParks&quot; startrow=&quot;#StartRow#&quot; maxrows=&quot;#MaxRows#&quot;&gt;
   &lt;tr&gt;
      &lt;td valign=&quot;top&quot; bgcolor=&quot;ffffed&quot;&gt;
         &lt;b&gt;#GetParks.CurrentRow#&lt;/b&gt;
      &lt;/td&gt;
      &lt;td valign=&quot;top&quot;&gt;
         &lt;font size=&quot;-1&quot;&gt;#ParkName#&lt;/font&gt;
      &lt;/td&gt;
      &lt;td valign=&quot;top&quot;&gt;
         &lt;font size=&quot;-1&quot;&gt;#Region#&lt;/font&gt;
      &lt;/td&gt;
      &lt;td valign=&quot;top&quot;&gt;
         &lt;font size=&quot;-1&quot;&gt;#State#&lt;/font&gt;
      &lt;/td&gt;
   &lt;/tr&gt;
&lt;/cfoutput&gt;
&lt;!--- If the total number of records is less than or equal
to the total number of rows, then offer a link to
the same page, with the startrow value incremented by
maxrows (in the case of this example, incremented by 10). ---------&gt;
   &lt;tr&gt;
      &lt;td colspan=&quot;4&quot;&gt;
      &lt;cfif (StartRow + MaxRows) LTE GetParks.RecordCount&gt;
         &lt;cfoutput&gt;&lt;a href=&quot;#CGI.SCRIPT_NAME#?startrow=#Evaluate(StartRow + MaxRows)#&quot;&gt;
         See next #MaxRows# rows&lt;/a&gt;&lt;/cfoutput&gt; 
      &lt;/cfif&gt;
      &lt;/td&gt;
   &lt;/tr&gt;
&lt;/table&gt; 
</pre>

<hr />
<p align="right"><p align="right"><a href="00000315.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000317.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000316.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



