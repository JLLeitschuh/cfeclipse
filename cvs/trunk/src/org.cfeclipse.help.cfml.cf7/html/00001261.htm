<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Updating data</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001260.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001262.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Updating data</h1>
<p>You usually use the following two application pages to update data in a database:</p>
<ul>
<li>
   An update form
</li>
<li>
   An update action page
</li>
</ul>
<p>You can create an update form with <a href="00000256.htm#2433198"><code>cfform</code></a> tags or HTML form tags. The update form calls an update action page, which can contain either a <a href="00000350.htm#1104662"><code>cfupdate</code></a> tag or a <a href="00000316.htm#1102316"><code>cfquery</code></a> tag with a SQL UPDATE statement. The update action page should also contain a confirmation message for the end user.</p>
<h2><a name="wp1101431"></a>Creating an update form</h2>
<p>The following are the key differences between an update form and an insert form:</p>
<ul>
<li>
   An update form contains a reference to the primary key of the record that is being updated. 
<p>A <i>primary key</i> is a field(s) in a database table that uniquely identifies each record. For example, in a table of employee names and addresses, only the Emp_ID is unique to each record. </p>
</li>
<li>
   An update form is usually populated with existing record data.
</li>
</ul>
<p>The easiest way to designate the primary key in an update form is to include a hidden input field with the value of the primary key for the record you want to update. The hidden field indicates to ColdFusion which record to update.</p>
<h4>To create an update form:</h4>
<ol>
<li>
   Create a ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Update Form&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;cfquery name=&quot;GetRecordtoUpdate&quot;
	datasource=&quot;cfdocexamples&quot;&gt;
	SELECT * FROM Employee
	WHERE Emp_ID = #URL.Emp_ID#
&lt;/cfquery&gt;


&lt;cfoutput query=&quot;GetRecordtoUpdate&quot;&gt;
&lt;table&gt;
&lt;form action=&quot;update_action.cfm&quot; method=&quot;Post&quot;&gt;
	&lt;input type=&quot;Hidden&quot; name=&quot;Emp_ID&quot;
		value=&quot;#Emp_ID#&quot;&gt;&lt;br&gt;
&lt;tr&gt;
	&lt;td&gt;First Name:&lt;/td&gt; 
	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;FirstName&quot; value=&quot;#FirstName#&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
	&lt;td&gt;Last Name:&lt;/td&gt;
	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;LastName&quot; value=&quot;#LastName#&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
	&lt;td&gt;Department Number:&lt;/td&gt;
	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;Dept_ID&quot; value=&quot;#Dept_ID#&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
	&lt;td&gt;Start Date:&lt;/td&gt;
	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;StartDate&quot; value=&quot;#StartDate#&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
	&lt;td&gt;Salary:&lt;/td&gt;
	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;Salary&quot; value=&quot;#Salary#&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
	&lt;td&gt;Contractor:&lt;/td&gt;
	&lt;td&gt;&lt;cfif #Contract# IS &quot;Yes&quot;&gt;
		&lt;input type=&quot;checkbox&quot; name=&quot;Contract&quot; checked&gt;Yes
	&lt;cfelse&gt;
		&lt;input type=&quot;checkbox&quot; name=&quot;Contract&quot;&gt;Yes
	&lt;/cfif&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
	&lt;td&gt;&amp;nbsp;&lt;/td&gt;
	&lt;td&gt;&lt;input type=&quot;Submit&quot; value=&quot;Update Information&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;/cfoutput&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file as update_form.cfm.
</li>
<li>
   View update_form.cfm in your web browser by specifying the page URL and an Employee ID; for example, enter the following:
<p>http://localhost/myapps/update_form.cfm?Emp_ID=3</p>
<p><strong>Note: </strong>Although you can view an employee's information, you must code an action page before you can update the database. For more information, see <a href="00001261.htm#1127880">Creating an action page to update data</a>.</p></li>
</ol>
<h4><a name="wp1127742"></a>Reviewing the code</h4>
<p>The following table describes the code and its function:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre>&lt;cfquery name=&quot;GetRecordtoUpdate&quot;
   datasource=&quot;cfdocexamples&quot;&gt;
   SELECT * FROM Employee
   WHERE Emp_ID = #URL.Emp_ID#
&lt;/cfquery&gt;
</pre>    </td>
    <td>
<p>Queries the cfdocexamples data source and returns records in which the employee ID matches what was entered in the URL that called this page.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;cfoutput query=&quot;GetRecordtoUpdate&quot;&gt;
...
&lt;/cfoutput&gt;
</pre>    </td>
    <td>
<p>Makes available as variables the results of the GetRecordtoUpdate query in the form created in subsequent lines.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;form action=&quot;update_action.cfm&quot; method=&quot;Post&quot;&gt;
...
&lt;/form&gt;
</pre>    </td>
    <td>
<p>Creates a form whose variables will be processed on the update_action.cfm action page.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;input type=&quot;Hidden&quot; name=&quot;Emp_ID&quot;
   value=&quot;#Emp_ID#&quot;&gt;&lt;br&gt;
</pre>    </td>
    <td>
<p>Uses a hidden input field to pass the Emp_ID (primary key) value to the action page.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>First Name: 
&lt;input type=&quot;text&quot; name=&quot;FirstName&quot;<br />value=&quot;#FirstName#&quot;&gt;&lt;br&gt;
Last Name: 
&lt;input type=&quot;text&quot; name=&quot;LastName&quot;<br />value=&quot;#LastName#&quot;&gt;&lt;br&gt;
Department Number: 
&lt;input type=&quot;text&quot; name=&quot;Dept_ID&quot;<br />      value=&quot;#Dept_ID#&quot;&gt;&lt;br&gt;
Start Date: 
&lt;input type=&quot;text&quot; name=&quot;StartDate&quot;<br />value=&quot;#StartDate#&quot;&gt;&lt;br&gt;
Salary: 
&lt;input type=&quot;text&quot; name=&quot;Salary&quot;<br />value=&quot;#Salary#&quot;&gt;&lt;br&gt;
</pre>    </td>
    <td>
<p>Populates the fields of the update form. This example does not use ColdFusion formatting functions. As a result, start dates look like 1985-03-12 00:00:00 and salaries do not have dollar signs or commas. The user can replace the information in any field using any valid input format for the data.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>Contractor: 
&lt;cfif #Contract# IS &quot;Yes&quot;&gt;
   &lt;input type=&quot;checkbox&quot; name=&quot;Contract&quot;<br />      checked&gt;Yes&lt;br&gt;
&lt;cfelse&gt;
   &lt;input type=&quot;checkbox&quot; name=&quot;Contract&quot;&gt;<br />      Yes &lt;br&gt;
&lt;/cfif&gt;
&lt;br&gt;
&lt;input type=&quot;Submit&quot; value=&quot;Update Information&quot;&gt;
&lt;/form&gt;
&lt;/cfoutput&gt;
</pre>    </td>
    <td>
<p>The Contract field requires special treatment because a check box displays and sets its value. The <a href="00000274.htm#1100123"><code>cfif</code></a> structure puts a check mark in the check box if the Contract field value is Yes, and leaves the box empty otherwise.</p>
    </td>
  </tr>
</table>

<h2><a name="wp1127880"></a>Creating an action page to update data</h2>
<p>You can create an action page to update data with either the <a href="00000350.htm#1104662"><code>cfupdate</code></a> tag or <a href="00000316.htm#1102316"><code>cfquery</code></a> with the UPDATE statement.</p>
<h3><a name="wp1110949"></a>Creating an update action page with cfupdate</h3>
<p>The <a href="00000350.htm#1104662"><code>cfupdate</code></a> tag is the easiest way to handle simple updates from a front-end form. The <code>cfupdate</code> tag has an almost identical syntax to the <a href="00000280.htm#1100472"><code>cfinsert</code></a> tag.</p>
<p>To use the <code>cfupdate</code> tag, you must include the primary key field(s) in your form submittal. The <code>cfupdate</code> tag automatically detects the primary key field(s) in the table that you are updating and looks for them in the submitted form fields. ColdFusion uses the primary key field(s) to select the record to update (therefore, you cannot update the primary key value itself). It then uses the remaining form fields that you submit to update the corresponding fields in the record. Your form only needs to have fields for the database fields that you want to change.</p>
<h4>To create an update page with cfupdate:</h4>
<ol>
<li>
   Create a ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Update Employee&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;cfif not isdefined(&quot;Form.Contract&quot;)&gt;
	&lt;cfset form.contract = &quot;No&quot;&gt;
&lt;cfelse&gt;
	&lt;cfset form.contract = &quot;Yes&quot;&gt;
&lt;/cfif&gt;

&lt;cfupdate datasource=&quot;cfdocexamples&quot;
	tablename=&quot;Employee&quot;&gt;

&lt;h1&gt;Employee Updated&lt;/h1&gt;
&lt;cfoutput&gt;
You have updated the information for #Form.FirstName#
#Form.LastName# in the employee database.
&lt;/cfoutput&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the page as update_action.cfm.
</li>
<li>
   View update_form.cfm in your web browser by specifying the page URL and an Employee ID; for example, enter the following:
<p><strong>http://localhost/myapps/update_form.cfm?Emp_ID=3</strong></p>
<p>The current information for that record appears:</p>
<p><br />
<img src="images/update_f.jpg" alt="An HTML update form using the cfupdate tag" border="0" hspace="0" vspace="0"/>
<br />
</p>
</li>
<li>
   Enter new values in any of the fields, and click Update Information.
<p>ColdFusion updates the record in the Employee table with your new values and displays a confirmation message.</p>
</li>
</ol>
<h4><a name="wp1110979"></a>Reviewing the code</h4>
<p>The following table describes the code and its function:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre>&lt;cfif not isdefined(&quot;Form.Contract&quot;)&gt;
   &lt;cfset Form.contract = &quot;No&quot;&gt;
&lt;cfelse&gt;
   &lt;cfset form.contract = &quot;Yes&quot;&gt;
&lt;/cfif&gt;
</pre>    </td>
    <td>
<p>Sets the value of Form.Contract to No if it is not defined, or to Yes if it is defined. If the Contractor check box is unchecked, no value is passed to the action page; however, the database field must have some value. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;cfupdate datasource=&quot;cfdocexamples&quot;
   tablename=&quot;Employee&quot;&gt;
</pre>    </td>
    <td>
<p>Updates the record in the database that matches the primary key on the form (Emp_ID). Updates all fields in the record with names that match the names of form controls.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cfoutput&gt;
You have updated the information for
   #Form.FirstName# #Form.LastName#
   in the employee database.
&lt;/cfoutput&gt;
</pre>    </td>
    <td>
<p>Informs the user that the change was made successfully.</p>
    </td>
  </tr>
</table>

<h3><a name="wp1110980"></a>Creating an update action page with cfquery</h3>
<p>For more complicated updates, you can use a SQL UPDATE statement in a <a href="00000316.htm#1102316"><code>cfquery</code></a> tag instead of a <a href="00000350.htm#1104662"><code>cfupdate</code></a> tag. The SQL UPDATE statement is more flexible for complicated updates.</p>
<p>The following procedure assumes that you have created the update_action.cfm page as described in <a href="00001261.htm#1110949">Creating an update action page with cfupdate</a>.</p>
<h4>To create an update page with cfquery:</h4>
<ol>
<li>
   In update_action.cfm, replace the <code>cfupdate</code> tag with the following highlighted <code>cfquery</code> code:
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Update Employee&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;cfif not isdefined(&quot;Form.Contract&quot;)&gt;
	&lt;cfset form.contract = &quot;No&quot;&gt;
&lt;cfelse&gt;
	&lt;cfset form.contract = &quot;Yes&quot;&gt;
&lt;/cfif&gt;

&lt;!--- cfquery requires date formatting when retrieving from 
Access. Use the left function when setting StartDate to trim
the &quot;.0&quot; from the date when it first appears from the 
Access database ---&gt;
 &lt;cfquery name=&quot;UpdateEmployee&quot; datasource=&quot;cfdocexamples&quot;&gt;
	UPDATE Employee
	SET FirstName = &#39;#Form.Firstname#&#39;,
		LastName = &#39;#Form.LastName#&#39;,
		Dept_ID = #Form.Dept_ID#,
		StartDate = &#39;#left(Form.StartDate,19)#&#39;,
		Salary = #Form.Salary#
	WHERE Emp_ID = #Form.Emp_ID#
&lt;/cfquery&gt;

&lt;h1&gt;Employee Updated&lt;/h1&gt;
&lt;cfoutput&gt;
You have updated the information for 
#Form.FirstName# #Form.LastName# 
in the employee database.
&lt;/cfoutput&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the page.
</li>
<li>
   View update_form.cfm in your web browser by specifying the page URL and an Employee ID; for example, enter the following:
<p><strong>http://localhost/myapps/update_form.cfm?Emp_ID=3</strong></p>
</li>
<li>
   Enter new values in any of the fields, and click Update Information.
<p>ColdFusion updates the record in the Employee table with your new values and displays a confirmation message.</p>
</li>
</ol>
<p>When the <code>cfquery</code> tag retrieves date information from a Microsoft Access database, it displays the date and time with tenths of seconds, as follows:</p>
<p><br />
<img src="images/start_d2.jpg" alt="Date information including tenths of seconds" border="0" hspace="0" vspace="0"/>
<br />
</p>
<p>This example uses the <a href="00000545.htm#130173"><code>Left</code></a> function to trim the two final characters. The cfdocexamples data source connects to company.mdb.</p>
<h4><a name="wp1127903"></a>Reviewing the code</h4>
<p>The following table describes the highlighted code and its function:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre>&lt;cfquery name=&quot;UpdateEmployee&quot;
   datasource=&quot;cfdocexamples&quot;&gt;
   UPDATE Employee
   SET FirstName = &#39;#Form.Firstname#&#39;,
      LastName = &#39;#Form.LastName#&#39;,
      Dept_ID = #Form.Dept_ID#,
      StartDate = &#39;#left(Form.StartDate,19)#&#39;,
      Salary = #Form.Salary#
   WHERE Emp_ID = #Form.Emp_ID#
&lt;/cfquery&gt;
</pre>    </td>
    <td>
<p>Updates the specified columns in the record in the Employee table of the cfdocexamples database that matches the primary key (Emp_ID). </p>
<p>Because #Form.Dept_ID#, #Form.Salary#, and #Form.Emp_ID# are numeric, they do not need to be enclosed in quotation marks.</p>
<p>Because of the way <a href="00000316.htm#1102316"><code>cfquery</code></a> gets and displays dates from Access databases, you use the <a href="00000545.htm#130173"><code>Left</code></a> function to trim the returned value.</p>
    </td>
  </tr>
</table>



<hr />
<p align="right"><p align="right"><a href="00001260.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001262.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001261.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



