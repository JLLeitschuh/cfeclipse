<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Indexing data returned by a query</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001316.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001318.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Indexing data returned by a query</h1>
<p>Indexing the results of a query is similar to indexing physical files located on your website, with the added step that you must write a query that retrieves the data you want to search. The following are the steps to perform a Verity search on record sets returned from a query:</p>
<ol>
<li>
   Create a collection.
</li>
<li>
   Write a query that retrieves the data you want to search, and generate a record set.
</li>
<li>
   Index the record set using the <code>cfindex</code> tag.
<p>The <code>cfindex</code> tag indexes the record set as if it were a collection of documents in a folder within your website. </p>
</li>
<li>
   Search the collection. 
<p>The information returned from the collection includes the database key and other selected columns. You can then use the information as-is, or use the key value to retrieve the entire row from the database table.</p>
</li>
</ol>
<p>You should use Verity to search databases in the following cases:</p>
<ul>
<li>
   You want to perform full-text search on database data. You can search Verity collections that contain textual data much more efficiently with a Verity search than using SQL to search database tables.
</li>
<li>
   You want to give your users access to data without interacting directly with the data source itself.
</li>
<li>
   You want to improve the speed of queries.
</li>
<li>
   You want users to be able to execute queries, but not update database tables.
</li>
</ul>
<p>Unlike indexing documents stored on your web server, indexing information contained in a database requires an additional step--you must first write a query (using the <a href="00000316.htm#1102316"><code>cfquery</code></a>, <a href="00000283.htm#1100581"><code>cfldap</code></a>, or <a href="00000311.htm#1101854"><code>cfpop</code></a> tag) that retrieves the data you want to let your users search. You then pass the information retrieved by the query to a <code>cfindex</code> tag, which indexes the data.</p>
<p>When indexing data with the <code>cfindex</code> tag, you must specify which column of the query represents the filename, which column represents the document title, and which column (or columns) represents the document's body (the information that you want to make searchable).</p>
<p>When indexing a recordset retrieved from a database, the <code>cfindex</code> tag uses the following attributes that correspond to the data source:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Attribute
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<p>key</p>
    </td>
    <td>
<p>Primary key column of the data source table.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>title</p>
    </td>
    <td>
<p>Specifies a query column name.</p>
    </td>
  </tr>
  <tr>
    <td>
<p>body</p>
    </td>
    <td>
<p>Columns that you want to search for the index. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>type</p>
    </td>
    <td>
<p>If set to <code>custom</code>, this attribute specifies the columns that you want to index. If set to <code>file</code> or <code>path</code>, this is a column that contains either a directory path and filename, or a directory path that contains the documents to be indexed.</p>
    </td>
  </tr>
</table>

<p>Using the <code>cfindex</code> tag to index tabular data is similar to indexing documents, with the exception that you refer to column names from the generated record set in the <code>body</code> attribute. In the following example, the <code>type</code> attribute is set to <code>custom</code>, specifying that the <code>cfindex</code> tag index the contents of the record set columns Emp_ID, FirstName, LastName, and Salary, which are identified using the <code>body</code> attribute. The Emp_ID column is listed as the <code>key</code> attribute, making it the primary key for the record set.</p>
<h4>To index a ColdFusion query:</h4>
<ol>
<li>
   Create a Verity collection for the data that you want to index.
<p>The following example assumes that you have a Verity collection named CodeColl. You can use the ColdFusion&#160;MX Administrator to create the collection, or you can create the collection programmatically by using the <code>cfcollection</code> tag. For more information, see <a href="00001307.htm#1142586">Creating a collection with the ColdFusion&#160;MX Administrator</a> or <a href="00001307.htm#1182070">Creating a collection with the cfcollection tag</a>.</p>
</li>
<li>
   Create a ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Adding Query Data to an Index&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;!--- Retrieve data from the table. ---&gt;
&lt;cfquery name=&quot;getEmps&quot; datasource=&quot;cfdocexamples&quot;&gt;
	SELECT * FROM EMPLOYEE
&lt;/cfquery&gt;

&lt;!--- Update the collection with the above query results. ---&gt;
&lt;cfindex 
	query=&quot;getEmps&quot;
	collection=&quot;CodeColl&quot;
	action=&quot;Update&quot;
	type=&quot;Custom&quot;
	key=&quot;Emp_ID&quot;
	title=&quot;Emp_ID&quot;
	body=&quot;Emp_ID,FirstName,LastName,Salary&quot;&gt;

&lt;h2&gt;Indexing Complete&lt;/h2&gt;

&lt;!--- Output the record set. ---&gt;
&lt;p&gt;Your collection now includes the following items:&lt;/p&gt;
&lt;cfoutput query=&quot;getEmps&quot;&gt;
	&lt;p&gt;#Emp_ID# #FirstName# #LastName# #Salary#&lt;/p&gt;
&lt;/cfoutput&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file as collection_db_index.cfm in the myapps directory under the web root directory.
</li>
<li>
   Open the file in the web browser to index the collection.
<p>The resulting record set appears.</p>
</li>
</ol>
<h4>To search and display the query results:</h4>
<ol>
<li>
   Create a ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Searching a collection&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h2&gt;Searching a collection&lt;/h2&gt;

&lt;form method=&quot;post&quot; action=&quot;collection_db_results.cfm&quot;&gt;
	&lt;p&gt;Collection name: &lt;input type=&quot;text&quot; name=&quot;collname&quot; size=&quot;30&quot; 
maxLength=&quot;30&quot;&gt;&lt;/p&gt;

	&lt;p&gt;Enter search term(s) in the box below. You can use AND, OR, NOT, 
	and parentheses. Surround an exact phrase with quotation marks.&lt;/p&gt;
	&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;criteria&quot; size=&quot;50&quot; maxLength=&quot;50&quot;&gt;
	&lt;/p&gt;
	&lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Search&quot;&gt;&lt;/p&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file as collection_db_search_form.cfm in the myapps directory under the <i>web_root</i>.
<p>This file is similar to collection_search_form.cfm, except the form uses collection_db_results.cfm, which you create in the next step, as its action page.</p>
</li>
<li>
   Create another ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Search Results&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;cfsearch 
   collection=&quot;#Form.collname#&quot;
   name=&quot;getEmps&quot;
   criteria=&quot;#Form.Criteria#&quot;
	maxrows = &quot;100&quot;&gt;

&lt;!--- Output the record set. ---&gt;
&lt;cfoutput&gt;
Your search returned #getEmps.RecordCount# file(s).
&lt;/cfoutput&gt;

&lt;cfoutput query=&quot;getEmps&quot;&gt;
	&lt;p&gt;&lt;table&gt;
	&lt;tr&gt;&lt;td&gt;Title: &lt;/td&gt;&lt;td&gt;#Title#&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;Score: &lt;/td&gt;&lt;td&gt;#Score#&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;Key: &lt;/td&gt;&lt;td&gt;#Key#&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;Summary: &lt;/td&gt;&lt;td&gt;#Summary#&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;Custom 1:&lt;/td&gt;&lt;td&gt;#Custom1#&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;Column list: &lt;/td&gt;&lt;td&gt;#ColumnList#&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&lt;/p&gt;

&lt;/cfoutput&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file as collection_db_results.cfm in the myapps directory under the <i>web_root</i>.
</li>
<li>
   View collection_db_search_form.cfm in the web browser and enter the name of the collection and search terms.
</li>
</ol>


<hr />
<p align="right"><p align="right"><a href="00001316.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001318.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001317.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



