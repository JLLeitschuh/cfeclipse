<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Building flexible search interfaces</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001342.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001344.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Building flexible search interfaces</h1>
<p>One option with forms is to build a search based on the form data. For example, you could use form data as part of the WHERE clause to construct a database query.</p>
<p>To give users the option to enter multiple search criteria in a form, you can wrap conditional logic around a SQL AND clause as part of the WHERE clause. The following action page allows users to search for employees by department, last name, or both.</p>
<p><strong>Note: </strong>ColdFusion&#160;MX provides the Verity search utility that you can also use to perform a search. For more information, see <a href="00001301.htm#1164916">Building a Search Interface</a>. </p><h4>To build a more flexible search interface:</h4>
<ol>
<li>
   Open the ColdFusion actionpage.cfm page in your editor.
</li>
<li>
   Modify the page so that it appears as follows:
<pre>
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Retrieving Employee Data Based on Criteria from Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;cfquery name=&quot;GetEmployees&quot; datasource=&quot;cfdocexamples&quot;&gt; 
	SELECT Departmt.Dept_Name,
		Employee.FirstName,
		Employee.LastName,
		Employee.StartDate,
		Employee.Salary
	FROM Departmt, Employee
	WHERE Departmt.Dept_ID = Employee.Dept_ID
	&lt;cfif IsDefined(&quot;Form.Department&quot;)&gt;<br />
AND Departmt.Dept_Name=&lt;cfqueryparam value=&quot;#Form.Department#&quot; <br />
			CFSQLType=&quot;CF_SQL_VARCHAR&quot;&gt; 
	&lt;/cfif&gt;
	&lt;cfif Form.LastName IS NOT &quot;&quot;&gt;
		AND Employee.LastName=&lt;cfqueryparam value=&quot;#Form.LastName#&quot; <br />
			CFSQLType=&quot;CF_SQL_VARCHAR&quot;&gt;
	&lt;/cfif&gt;
&lt;/cfquery&gt;

&lt;h4&gt;Employee Data Based on Criteria from Form&lt;/h4&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;th&gt;First Name&lt;/th&gt;
&lt;th&gt;Last Name&lt;/th&gt;
&lt;th&gt;Salary&lt;/th&gt;
&lt;/tr&gt;
&lt;cfoutput query=&quot;GetEmployees&quot;&gt;
&lt;tr&gt;
&lt;td&gt;#FirstName#&lt;/td&gt;
&lt;td&gt;#LastName#&lt;/td&gt;
&lt;td&gt;#Salary#&lt;/td&gt;
&lt;/tr&gt;
&lt;/cfoutput&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file.
</li>
<li>
   View the formpage.cfm page in your browser.
</li>
<li>
   Select a department, optionally enter a last name, and submit the form.
</li>
</ol>
<h4><a name="wp1146639"></a>Reviewing the code</h4>
<p>The following table describes the highlighted code and its function:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre>SELECT  Departmt.Dept_Name,
   Employee.FirstName,
   Employee.LastName,
   Employee.StartDate,
   Employee.Salary
   FROM Departmt, Employee
   WHERE Departmt.Dept_ID =<br />      Employee.Dept_ID
</pre>    </td>
    <td>
<p>Retrieves the fields listed from the Departmt and Employee tables, joining the tables based on the Dept_ID field in each table.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>   &lt;cfif IsDefined(&quot;FORM.Department&quot;)&gt;
   AND Departmt.Dept_Name = &lt;cfqueryparam <br />      value=&quot;#Form.Department#&quot; <br />      CFSQLType=&quot;CF_SQL_VARCHAR&quot;&gt;
   &lt;/cfif&gt;
</pre>    </td>
    <td>
<p>If the user specified a department on the form, only retrieves records where the department name is the same as the one that the user specified. You must use number signs (#) in the SQL AND statement to identify Form.Department as a ColdFusion variable, but not in the <a href="00000520.htm#1106482"><code>IsDefined</code></a> function.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cfif Form.LastName IS NOT &quot;&quot;&gt;
AND Employee.LastName = &lt;cfqueryparam <br />      value=&quot;#Form.LastName#&quot; <br />      CFSQLType=&quot;CF_SQL_VARCHAR&quot;&gt;
&lt;/cfif&gt;
</pre>    </td>
    <td>
<p>If the user specified a last name in the form, only retrieves the records in which the last name is the same as the one that the user entered in the form.</p>
    </td>
  </tr>
</table>



<hr />
<p align="right"><p align="right"><a href="00001342.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001344.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001343.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



