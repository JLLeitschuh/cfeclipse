<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Creating a search page</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001307.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001309.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Creating a search page</h1>
<p>You use the <a href="00000330.htm#1103106"><code>cfsearch</code></a> tag to search an indexed collection. Searching a Verity collection is similar to a standard ColdFusion query: both use a dedicated ColdFusion tag that requires a <code>name</code> attribute for their searches and both return a query object that contains rows matching the search criteria. The following table compares the two tags:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
cfquery
    </th>
    <th>
cfsearch
    </th>
  </tr>
  <tr>
    <td>
<p>Searches a data source</p>
    </td>
    <td>
<p>Searches a collection</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Requires a <code>name</code> attribute</p>
    </td>
    <td>
<p>Requires a <code>name</code> attribute</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Uses SQL statements to specify search criteria</p>
    </td>
    <td>
<p>Uses a criteria attribute to specify search criteria</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Returns variables keyed to database table field names</p>
    </td>
    <td>
<p>Returns a unique set of variables</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Uses <code>cfoutput</code> to display query results</p>
    </td>
    <td>
<p>Uses <code>cfoutput</code> to display search results</p>
    </td>
  </tr>
</table>

<p><strong>Note: </strong>You receive an error if you attempt to search a collection that has not been indexed.</p><p>The following are important attributes for the <code>cfsearch</code> tag:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Attribute
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<p><code>name</code></p>
    </td>
    <td>
<p>The name of the search query.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p><code>collection</code></p>
    </td>
    <td>
<p>The name of the collection(s) being searched. Separate multiple collections with a comma; for example, <code>collection = &quot;sprocket_docs,CodeColl&quot;</code><code>.</code></p>
    </td>
  </tr>
  <tr>
    <td>
<p><code>criteria</code></p>
    </td>
    <td>
<p>The search target (can be dynamic).</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>maxrows</p>
    </td>
    <td>
<p>The maximum number of records returned by the search. Always specify this attribute to ensure optimal performance (start with 300 or less, if possible).</p>
    </td>
  </tr>
</table>

<p>Each <code>cfsearch</code> returns variables that provide the following information about the search:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Attribute
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<p><code>RecordCount</code></p>
    </td>
    <td>
<p>The total number of records returned by the search.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p><code>CurrentRow</code></p>
    </td>
    <td>
<p>The current row of the record set.</p>
    </td>
  </tr>
  <tr>
    <td>
<p><code>RecordsSearched</code></p>
    </td>
    <td>
<p>The total number of records in the index that were searched. If no records were returned in the search, this property returns a null value.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p><code>Summary</code></p>
    </td>
    <td>
<p>Automatic summary saved by the <code>cfindex</code> tag.</p>
    </td>
  </tr>
  <tr>
    <td>
<p><code>Context</code></p>
    </td>
    <td>
<p>A context summary that contains the search terms, highlighted in bold (by default). This is enabled if you set the <code>contextpassages</code> attribute to a number greater than zero.</p>
    </td>
  </tr>
</table>

<p>Additionally, if you specify the <code>status</code> attribute, the <code>cfsearch</code> tag returns the status structure, which contains the information in the following table:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Variable
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre>found
</pre>    </td>
    <td>
<p>The number of documents that contain the search criteria. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>searched
</pre>    </td>
    <td>
<p>The number of documents searched. Corresponds to the <code>recordsSearched</code> column in the search results. </p>
    </td>
  </tr>
  <tr>
    <td>
<pre>time
</pre>    </td>
    <td>
<p>The number of milliseconds the search took, as reported by the Verity K2 search service. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>suggestedQuery
</pre>    </td>
    <td>
<p>An alternative query, as suggested by Verity, that may produce better results. This often contains corrected spellings of search terms. Present only when the <code>suggestions</code> tag attribute criteria is met.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>Keywords
</pre>    </td>
    <td>
<p>A structure that contains each search term as a key to an array of up to five possible alternative terms in order of preference. Present only when the <code>suggestions</code> tag attribute criteria is met.</p>
    </td>
  </tr>
</table>

<p>You can use search form and results pages similar to the following examples to search a collection.</p>
<h4>To create a search form:</h4>
<ol>
<li>
   Create a ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Searching a collection&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;Searching a collection&lt;/h2&gt;

&lt;form method=&quot;post&quot; action=&quot;collection_search_action.cfm&quot;&gt;
	&lt;p&gt;Enter search term(s) in the box below. You can use AND, OR, NOT, and
	parentheses. Surround an exact phrase with quotation marks.&lt;/p&gt;
	&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;criteria&quot; size=&quot;50&quot; maxLength=&quot;50&quot;&gt;
	&lt;/p&gt;
	&lt;input type=&quot;submit&quot; value=&quot;Search&quot;&gt; 
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file as collection_search_form.cfm.
</li>
</ol>
<p>Enter search target words in this form, which ColdFusion passes as the variable <code>criteria</code> to the action page, which displays the search results.</p>
<h4>To create the results page:</h4>
<ol>
<li>
   Create a ColdFusion page with the following content:
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Search Results&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;cfsearch 
	name = &quot;codecoll_results&quot;
	collection = &quot;CodeColl&quot;
	criteria = &quot;#Form.criteria#&quot;
	contextPassages = &quot;1&quot;
	contextBytes = &quot;300&quot;
	maxrows = &quot;100&quot;&gt;

&lt;h2&gt;Search Results&lt;/h2&gt;
&lt;cfoutput&gt;
Your search returned #codecoll_results.RecordCount# file(s).
&lt;/cfoutput&gt;

&lt;cfoutput query=&quot;codecoll_results&quot;&gt;
	&lt;p&gt;
	File: &lt;a href=&quot;#URL#&quot;&gt;#Key#&lt;/a&gt;&lt;br&gt;
	Document Title (if any): #Title#&lt;br&gt;
	Score: #Score#&lt;br&gt;
	Summary: #Summary#&lt;br&gt;
	Highlighted Summary: #context#&lt;/p&gt;
&lt;/cfoutput&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</li>
<li>
   Save the file as collection_search_action.cfm.
</li>
<li>
   View collection_search_form.cfm in the web browser.
</li>
<li>
   Enter a target word(s) and click Search.
</li>
</ol>
<p><strong>Note: </strong>As part of the indexing process, Verity automatically produces a summary of every document file or every query record set that gets indexed. The default summary result set column selects the best sentences, based on internal rules, up to a maximum of 500 characters. Every <code>cfsearch</code> operation returns summary information by default. For more information on this topic, see <a href="00001322.htm#1160419">Using Verity Search Expressions</a>. Alternatively, you can use the context result set column, which provides a context summary with highlighted search terms.</p>

<hr />
<p align="right"><p align="right"><a href="00001307.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001309.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001308.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



