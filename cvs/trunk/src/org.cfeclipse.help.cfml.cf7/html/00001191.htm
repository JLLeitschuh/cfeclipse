<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Example: Application.cfc</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001190.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001192.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Example: Application.cfc</h1>
<p>The Application.cfc page consists of the following:</p>
<pre>&lt;cfcomponent&gt;
&lt;cfset This.name = &quot;Orders&quot;&gt;
&lt;cfset This.Sessionmanagement=&quot;True&quot;&gt;
&lt;cfset This.loginstorage=&quot;session&quot;&gt;

&lt;cffunction name=&quot;OnRequestStart&quot;&gt;
   &lt;cfargument name = &quot;request&quot; required=&quot;true&quot;/&gt;
   &lt;cfif IsDefined(&quot;Form.logout&quot;)&gt;
      &lt;cflogout&gt;
   &lt;/cfif&gt;

   &lt;cflogin&gt;
      &lt;cfif NOT IsDefined(&quot;cflogin&quot;)&gt;
         &lt;cfinclude template=&quot;loginform.cfm&quot;&gt;
         &lt;cfabort&gt;
      &lt;cfelse&gt;
         &lt;cfif cflogin.name IS &quot;&quot; OR cflogin.password IS &quot;&quot;&gt;
            &lt;cfoutput&gt;
               &lt;h2&gt;You must enter text in both the User Name and Password fields.<br />               &lt;/h2&gt;
            &lt;/cfoutput&gt;
            &lt;cfinclude template=&quot;loginform.cfm&quot;&gt;
            &lt;cfabort&gt;
         &lt;cfelse&gt;
            &lt;cfquery name=&quot;loginQuery&quot; dataSource=&quot;cfdocexamples&quot;&gt;
            SELECT UserID, Roles
            FROM LoginInfo
            WHERE
               UserID = &#39;#cflogin.name#&#39;
               AND Password = &#39;#cflogin.password#&#39;
            &lt;/cfquery&gt;
            &lt;cfif loginQuery.Roles NEQ &quot;&quot;&gt;
               &lt;cfloginuser name=&quot;#cflogin.name#&quot; Password = &quot;#cflogin.password#&quot;
                  roles=&quot;#loginQuery.Roles#&quot;&gt;
            &lt;cfelse&gt;
               &lt;cfoutput&gt;
                  &lt;H2&gt;Your login information is not valid.&lt;br&gt;
                  Please Try again&lt;/H2&gt;
               &lt;/cfoutput&gt;   
               &lt;cfinclude template=&quot;loginform.cfm&quot;&gt;
               &lt;cfabort&gt;
            &lt;/cfif&gt;
         &lt;/cfif&gt;   
      &lt;/cfif&gt;
   &lt;/cflogin&gt;

   &lt;cfif GetAuthUser() NEQ &quot;&quot;&gt;
      &lt;cfoutput&gt;
          &lt;form action=&quot;securitytest.cfm&quot; method=&quot;Post&quot;&gt;
            &lt;input type=&quot;submit&quot; Name=&quot;Logout&quot; value=&quot;Logout&quot;&gt;
         &lt;/form&gt;
      &lt;/cfoutput&gt;
   &lt;/cfif&gt;

&lt;/cffunction&gt;
&lt;/cfcomponent&gt;
</pre><h4><a name="wp1117177"></a>Reviewing the code</h4>
<p>The Application.cfc page executes before the code in each ColdFusion page in an application. For more information on the Application.cfc page and when it is executed, see <a href="00001102.htm#1101532">Designing and Optimizing a ColdFusion&#160;Application</a>.</p>
<p>The following table describes the CFML code in Application.cfc and its function:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<pre>&lt;cfcomponent&gt;
&lt;cfset This.name = &quot;Orders&quot;&gt;
&lt;cfset This.Sessionmanagement=&quot;True&quot;&gt;
&lt;cffunction name=&quot;OnRequestStart&quot;&gt;
   &lt;cfargument name = &quot;request&quot;
      required=&quot;true&quot;/&gt;
</pre>    </td>
    <td>
<p>Identifies the application, enables session management, and enables storing login information in the Session scope.</p>
<p>Begins the definition of the <code>onRequestStart</code> method that runs at the starts of each request. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;cfif IsDefined(&quot;Form.logout&quot;)&gt;
   &lt;cflogout&gt;
&lt;/cfif&gt;
</pre>    </td>
    <td>
<p>If the user just submitted the logout form, logs out the user. The following <a href="00000287.htm#2991147"><code>cflogin</code></a><code> </code>tag runs as a result.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cflogin&gt;
   &lt;cfif NOT IsDefined(&quot;cflogin&quot;)&gt;
      &lt;cfinclude template=&quot;loginform.cfm&quot;&gt;
      &lt;cfabort&gt;

</pre>    </td>
    <td>
<p>Executes if there is no logged-in user.</p>
<p>Tests to see if the user has submitted a login form. If not, uses <code>cfinclude</code> to display the form. The built-in <code>cflogin</code> variable exists and contains the user name and password only if the login form used <code>j_username</code> and <code>j_password</code> for the input fields.</p>
<p>The <a href="00000215.htm#3835579"><code>cfabort</code></a> tag prevents processing of any code that follows on this page.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;cfelse&gt;
   &lt;cfif cflogin.name IS &quot;&quot; OR
      cflogin.password IS &quot;&quot;&gt;
      &lt;cfoutput&gt;
      &#160;&#160;&lt;H2&gt;You must enter text in both the
      &#160;&#160;User Name and Password fields&lt;/H2&gt;
      &lt;/cfoutput&gt;
      &lt;cfinclude template=&quot;loginform.cfm&quot;&gt;
      &lt;cfabort&gt;
</pre>    </td>
    <td>
<p>Executes if the user submitted a login form. </p>
<p>Tests to make sure that both name and password have data. If either variable is empty, displays a message, followed by the login form. </p>
<p>The <code>cfabort</code> tag prevents processing of any code that follows on this page.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cfelse&gt;
   &lt;cfquery name=&quot;loginQuery&quot;
         dataSource=&quot;cfdocexamples&quot;&gt;
      SELECT UserID, Roles
      FROM LoginInfo
      WHERE
         UserID = &#39;#cflogin.name#&#39;
         AND Password = &#39;#cflogin.password#&#39;
   &lt;/cfquery&gt;
</pre>    </td>
    <td>
<p>Executes if the user submitted a login form and both fields contain data. </p>
<p>Uses the cflogin structure's <code>name</code> and <code>password</code> entries to find the user record in the database and get the user's roles.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;cfif loginQuery.Roles NEQ &quot;&quot;&gt;
   &lt;cfloginuser name=&quot;#cflogin.name#&quot;
      Password = &quot;#cflogin.password#&quot;
      roles=&quot;#loginQuery.Roles#&quot;&gt;
</pre>    </td>
    <td>
<p>If the query returns data in the Roles field, logs in the user using the user's name and password and the Roles field from the database. In this application, every user must be in some role.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cfelse&gt;
   &lt;cfoutput&gt;
      &lt;H2&gt;Your login information is not
         valid.&lt;br&gt;
      Please Try again&lt;/H2&gt;
   &lt;/cfoutput&gt;   
   &lt;cfinclude template=&quot;loginform.cfm&quot;&gt;
   &lt;cfabort&gt;
</pre>    </td>
    <td>
<p>Executes if the query did not return a role. If the database is valid, this means there was no entry matching the user ID and password. Displays a message, followed by the login form. </p>
<p>The <code>cfabort</code> tag prevents processing of any code that follows on this page.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>         &lt;/cfif&gt;
      &lt;/cfif&gt;   
   &lt;/cfif&gt;
&lt;/cflogin&gt;
</pre>    </td>
    <td>
<p>Ends the loginquery.Roles test code.</p>
<p>Ends the form entry empty value test.</p>
<p>Ends the form entry existence test.</p>
<p>Ends the <code>cflogin</code> tag body.</p>
    </td>
  </tr>
  <tr>
    <td>
<pre>&lt;cfif GetAuthUser() NEQ &quot;&quot;&gt;
   &lt;cfoutput&gt;
      &lt;form action=&quot;MyApp/index.cfm&quot;
            method=&quot;Post&quot;&gt;
         &lt;input type=&quot;submit&quot; Name=&quot;Logout&quot;
            value=&quot;Logout&quot;&gt;
      &lt;/form&gt;
   &lt;/cfoutput&gt;
&lt;/cfif&gt;
</pre>    </td>
    <td>
<p>If a user is logged-in, displays the Logout button.</p>
<p>If the user clicks the button, posts the form to the application's (theoretical) entry page, index.cfm. </p>
<p>Application.cfc then logs out the user and displays the login form. If the user logs in again, ColdFusion displays index.cfm.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>&lt;/cffunction&gt;
&lt;/cfcomponent&gt;
</pre>    </td>
    <td>
<p>Ends the <code>onRequestStart</code> method</p>
<p>Ends the Application component.</p>
    </td>
  </tr>
</table>



<hr />
<p align="right"><p align="right"><a href="00001190.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001192.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001191.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



