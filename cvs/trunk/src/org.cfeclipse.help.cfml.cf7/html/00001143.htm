<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Using the cftry tag: an example</title>
</head>
<body>
<p align="right"><p align="right"><a href="00001142.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001144.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Using the cftry tag: an example</h1>
<p>The following example shows the <a href="00000349.htm#1104557"><code>cftry</code></a> and <a href="00000225.htm#3395038"><code>cfcatch</code></a> tags. It uses the cfdocexamples data source, which many of the examples in this manual use, and a sample included file, <code>includeme.cfm.</code></p>
<p>If an exception occurs during the <a href="00000316.htm#1102316"><code>cfquery</code></a> statement&#39;s execution, the application page flow switches to the <code>cfcatch</code> <code>type</code>=<code>&quot;Database&quot;</code> exception handler. It then resumes with the next statement after the <code>cftry</code> block, once the <code>cfcatch</code> <code>type</code>=<code>&quot;Database&quot;</code> handler completes. Similarly, the <code>cfcatch</code> <code>type</code>=<code>&quot;MissingInclude&quot;</code> block handles exceptions raised by the <a href="00000277.htm#1100248"><code>cfinclude</code></a> tag.</p>
<pre><code>&lt;!--- Wrap code you want to check in a cftry block ---&gt;</code>
<code>&lt;cfset EmpID=3&gt;</code>
<code>&lt;cfparam name=&quot;errorCaught&quot; default=&quot;&quot;&gt;</code>
<code>&lt;cftry&gt;</code>
<code>   &lt;cfquery name=&quot;test&quot; datasource=&quot;cfdocexamples&quot;&gt;</code>
<code>      SELECT Dept_ID, FirstName, LastName</code>
<code>      FROM Employee</code>
<code>      WHERE Emp_ID=#EmpID#</code>
<code>   &lt;/cfquery&gt;</code>

<code>   &lt;html&gt;</code>
<code>   &lt;head&gt;</code>
<code>   &lt;title&gt;Test cftry/cfcatch&lt;/title&gt;</code>
<code>   &lt;/head&gt;</code>
<code>   &lt;body&gt;</code>
<code>   &lt;cfinclude template=&quot;includeme.cfm&quot;&gt;</code>
<code>   &lt;cfoutput query=&quot;test&quot;&gt;</code>
<code>      &lt;p&gt;Department: #Dept_ID#&lt;br&gt;</code>
<code>      Last Name: #LastName#&lt;br&gt;</code>
<code>      First Name: #FirstName#&lt;/p&gt;</code>
<code>   &lt;/cfoutput&gt;</code>

<code>&lt;!--- Use cfcatch to test for missing included files. ---&gt;</code>
<code>&lt;!---    Print Message and Detail error messages. ---&gt;</code>
<code>&lt;!--- Block executes only if a MissingInclude exception is thrown. ---&gt;</code>
<code>   &lt;cfcatch type=&quot;MissingInclude&quot;&gt;</code>
<code>      &lt;h1&gt;Missing Include File&lt;/h1&gt;</code>
<code>      &lt;cfoutput&gt;</code>
<code>      &lt;ul&gt;</code>
<code>         &lt;li&gt;&lt;b&gt;Message:&lt;/b&gt; #cfcatch.Message#</code>
<code>         &lt;li&gt;&lt;b&gt;Detail:&lt;/b&gt; #cfcatch.Detail#</code>
<code>         &lt;li&gt;&lt;b&gt;File name:&lt;/b&gt; #cfcatch.MissingFileName#</code>
<code>      &lt;/ul&gt;</code>
<code>      &lt;/cfoutput&gt;</code>
<code>      &lt;cfset errorCaught = &quot;MissingInclude&quot;&gt;</code>
<code>   &lt;/cfcatch&gt;</code>

<code>&lt;!--- Use cfcatch to test for database errors.---&gt;</code>
<code>&lt;!---    Print error messages. ---&gt;</code>
<code>&lt;!--- Block executes only if a Database exception is thrown. ---&gt;</code>
<code>   &lt;cfcatch type=&quot;Database&quot;&gt;</code>
<code>      &lt;h1&gt;Database Error&lt;/h1&gt;</code>
<code>      &lt;cfoutput&gt;</code>
<code>      &lt;ul&gt;</code>
<code>         &lt;li&gt;&lt;b&gt;Message:&lt;/b&gt; #cfcatch.Message#</code>
<code>         &lt;li&gt;&lt;b&gt;Native error code:&lt;/b&gt; #cfcatch.NativeErrorCode#</code>
<code>         &lt;li&gt;&lt;b&gt;SQLState:&lt;/b&gt; #cfcatch.SQLState#</code>
<code>         &lt;li&gt;&lt;b&gt;Detail:&lt;/b&gt; #cfcatch.Detail#</code>
<code>         &lt;/ul&gt;</code>
<code>      &lt;/cfoutput&gt;</code>
<code>      &lt;cfset errorCaught = &quot;Database&quot;&gt;</code>
<code>   &lt;/cfcatch&gt;</code>

<code>&lt;!--- Use cfcatch with type=&quot;Any&quot; ---&gt;</code>
<code>&lt;!--- to find unexpected exceptions. ---&gt;</code>
<code>   &lt;cfcatch type=&quot;Any&quot;&gt;</code>
<code>      &lt;cfoutput&gt;</code>
<code>         &lt;hr&gt;</code>
<code>         &lt;h1&gt;Other Error: #cfcatch.Type#&lt;/h1&gt;</code>
<code>         &lt;ul&gt;</code>
<code>            &lt;li&gt;&lt;b&gt;Message:&lt;/b&gt; #cfcatch.Message#</code>
<code>            &lt;li&gt;&lt;b&gt;Detail:&lt;/b&gt; #cfcatch.Detail#</code>
<code>         &lt;/ul&gt;</code>
<code>      &lt;/cfoutput&gt;</code>
<code>      &lt;cfset errorCaught = &quot;General Exception&quot;&gt;</code>
<code>   &lt;/cfcatch&gt;</code>
<code>&lt;/body&gt;</code>
<code>&lt;/html&gt;</code>
<code>&lt;/cftry&gt;</code>
</pre><p>Use the following procedure to test the code.</p>
<h4>To test the code:</h4>
<ol>
<li>
   Make sure there is no includeme.cfm file and display the page. The <code>cfcatch type=&quot;MissingInclude&quot;</code> block displays the error.
</li>
<li>
   Create a nonempty includeme.cfm file and display the page. If your database is configured properly, you should see an employee entry and not get any error.
</li>
<li>
   In the <code>cfquery</code> tag, change the line:
<pre>
FROM Employee
</pre>
<p>to:</p>
<pre>
FROM Employer
</pre>
<p>Display the page. This time the <code>cfcatch type=&quot;Database&quot;</code> block displays an error message.</p>
</li>
<li>
   Change Employer to Employee. 
<p>Change the <code>cfoutput</code> line:</p>
<pre>
&lt;p&gt;Department: #Dept_ID#&lt;br&gt;
</pre>
<p>to:</p>
<pre>
&lt;p&gt;Department: #DepartmentID#&lt;br&gt;
</pre>
<p>Display the page. This time the <code>cfcatch type=&quot;Any&quot;</code> block displays an error message indicating an expression error.</p>
</li>
<li>
   Change DepartmentID back to Dept_ID and redisplay the page. The page displays properly.
<p>Open \CFusion\Log\MyAppPage.log in your text editor. You should see a header line, an initialization line, and four detail lines, similar to the following:</p>
<pre>
&quot;Severity&quot;,&quot;ThreadID&quot;,&quot;Date&quot;,&quot;Time&quot;,&quot;Application&quot;,&quot;Message&quot;
&quot;Information&quot;,&quot;web-0&quot;,&quot;11/20/01&quot;, &quot;16:27:08&quot;,, 
&quot;cf_root\runtime\servers\default\logs\ MyAppPage.log initialized&quot;
&quot;Information&quot;,&quot;web-0&quot;,&quot;11/20/01&quot;,&quot;16:27:08&quot;,,<br />
&quot;Page: web_root/MYStuff/MyDocs/ cftryexample.cfm Error: MissingInclude&quot;
&quot;Information&quot;,&quot;web-1&quot;,&quot;11/20/01&quot;,&quot;16:27:32&quot;,,&quot;<br />
Page: web_root/MYStuff/MyDocs/ cftryexample.cfm Error: &quot;
&quot;Information&quot;,&quot;web-0&quot;,&quot;11/20/01&quot;,&quot;16:27:49&quot;,,<br />
&quot;Page: web_root/MYStuff/MyDocs/ cftryexample.cfm Error: Database&quot;
&quot;Information&quot;,&quot;web-1&quot;,&quot;11/20/01&quot;,&quot;16:28:21&quot;,,<br />
&quot;Page: web_root/MYStuff/MyDocs/ cftryexample.cfm Error: General Exception&quot;
&quot;Information&quot;,&quot;web-0&quot;,&quot;11/20/01&quot;,&quot;16:28:49&quot;,,<br />
&quot;Page: web_root/MYStuff/MyDocs/ cftryexample.cfm Error: &quot;
</pre>
</li>
</ol>
<h4><a name="wp1132533"></a>Reviewing the code</h4>
<p>The following table describes the code:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code
    </th>
    <th>
Description
    </th>
  </tr>
  <tr>
    <td>
<p><code>&lt;cfset EmpID=3&gt;</code></p>
<p><code>&lt;cfparam name=&quot;errorCaught&quot; default=&quot;&quot;&gt;</code></p>
<p>&#160;</p>
    </td>
    <td>
<p>Initializes the employee ID to a valid value. An application would get the value from a form or other source.</p>
<p>Sets the default <code>errorCaught</code> variable value to the empty string (to indicate no error was caught).</p>
<p>There is no need to put these lines in a <code>cftry</code> block.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p><code>&lt;cftry&gt;</code></p>
<p><code>&lt;cfquery name=&quot;test&quot;<br />		datasource=&quot;cfdocexamples&quot;&gt;</code></p>
<p><code>	SELECT Dept_ID, FirstName, LastName</code></p>
<p><code>	FROM Employee</code></p>
<p><code>	WHERE Emp_ID=#EmpID#</code></p>
<p><code>&lt;/cfquery&gt;</code></p>
    </td>
    <td>
<p>Starts the <code>cftry</code> block. Exceptions from here to the end of the block can be caught by <code>cfcatch</code> tags.</p>
<p>Queries the cfdocexamples database to get the data for the employee identified by the <code>EmpID</code> variable.</p>
    </td>
  </tr>
  <tr>
    <td>
<p><code>&lt;html&gt;</code></p>
<p><code>&lt;head&gt;</code></p>
<p><code>&lt;title&gt;Test cftry/cfcatch&lt;/title&gt;</code></p>
<p><code>&lt;/head&gt;</code></p>
<p><code>&lt;body&gt;</code></p>
<p><code>&lt;cfinclude template=&quot;includeme.cfm&quot;&gt;</code></p>
<p><code>&lt;cfoutput query=&quot;test&quot;&gt;</code></p>
<p><code>	&lt;p&gt;Department: #Dept_ID#&lt;br&gt;</code></p>
<p><code>	Last Name: #LastName#&lt;br&gt;</code></p>
<p><code>	First Name: #FirstName#&lt;/p&gt;</code></p>
<p><code>&lt;/cfoutput&gt;</code></p>
    </td>
    <td>
<p>Begins the HTML page. This section contains all the code that displays information if no errors occur.</p>
<p>Includes the includeme.cfm page.</p>
<p>Displays the user information record from the test query.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p><code>&lt;cfcatch type=&quot;MissingInclude&quot;&gt;</code></p>
<p><code>	&lt;h1&gt;Missing Include File&lt;/h1&gt;</code></p>
<p><code>	&lt;cfoutput&gt;</code></p>
<p><code>	&lt;ul&gt;</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;Message:&lt;/b&gt; #cfcatch.Message#</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;Detail:&lt;/b&gt; #cfcatch.Detail#</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;File name:&lt;/b&gt;<br />			#cfcatch.MissingFilename#</code></p>
<p><code>	&lt;/ul&gt;</code></p>
<p><code>	&lt;/cfoutput&gt;</code></p>
<p><code>	&lt;cfset errorCaught = &quot;MissingInclude&quot;&gt;</code></p>
<p><code>&lt;/cfcatch&gt;</code></p>
    </td>
    <td>
<p>Handles exceptions thrown when a page specified by the <code>cfinclude</code> tag cannot be found. </p>
<p>Displays <code>cfcatch</code> variables, including the ColdFusion basic error message, detail message, and the name of the file that could not be found.</p>
<p>Sets the <code>errorCaught</code> variable to indicate the error type.</p>
    </td>
  </tr>
  <tr>
    <td>
<p><code>&lt;cfcatch type=&quot;Database&quot;&gt;</code></p>
<p><code>	&lt;h1&gt;Database Error&lt;/h1&gt;</code></p>
<p><code>	&lt;cfoutput&gt;</code></p>
<p><code>	&lt;ul&gt;</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;Message:&lt;/b&gt; #cfcatch.Message#</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;Native error code:&lt;/b&gt;<br />			#cfcatch.NativeErrorCode#</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;SQLState:&lt;/b&gt; #cfcatch.SQLState#</code></p>
<p><code>		&lt;li&gt;&lt;b&gt;Detail:&lt;/b&gt; #cfcatch.Detail#</code></p>
<p><code>		&lt;/ul&gt;</code></p>
<p><code>	&lt;/cfoutput&gt;</code></p>
<p><code>	&lt;cfset errorCaught = &quot;Database&quot;&gt;</code></p>
<p><code>&lt;/cfcatch&gt;</code></p>
    </td>
    <td>
<p>Handles exceptions thrown when accessing a database. </p>
<p>Displays <code>cfcatch</code> variables, including the ColdFusion basic error message, the error code and SQL state reported by the databases system, and the detailed error message.</p>
<p>Sets the <code>errorCaught</code> variable to indicate the error type.</p>
<p>&#160;</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p><code>&lt;cfcatch type=&quot;Any&quot;&gt;</code></p>
<p><code>	&lt;cfoutput&gt;</code></p>
<p><code>		&lt;hr&gt;</code></p>
<p><code>		&lt;h1&gt;Other Error: #cfcatch.Type#&lt;/h1&gt;</code></p>
<p><code>		&lt;ul&gt;</code></p>
<p><code>			&lt;li&gt;&lt;b&gt;Message:&lt;/b&gt; #cfcatch.message#</code></p>
<p><code>			&lt;li&gt;&lt;b&gt;Detail:&lt;/b&gt; #cfcatch.Detail#</code></p>
<p><code>		&lt;/ul&gt;</code></p>
<p><code>	&lt;/cfoutput&gt;</code></p>
<p><code>	&lt;cfset errorCaught = &quot;General Exception&quot;&gt;</code></p>
<p><code>&lt;/cfcatch&gt;</code></p>
    </td>
    <td>
<p>Handles any other exceptions generated in the <code>cftry</code> block.</p>
<p>Since the error can occur after information has displayed (in this case, the contents of the include file), draws a line before writing the message text.</p>
<p>Displays the ColdFusion basic and detailed error message.</p>
<p>Sets the <code>errorCaught</code> variable to indicate the error type.</p>
    </td>
  </tr>
  <tr>
    <td>
<p><code>&lt;/body&gt;</code></p>
<p><code>&lt;/html&gt;</code></p>
<p><code>&lt;/cftry&gt;</code></p>
    </td>
    <td>
<p>Ends the HTML page, then the <code>cftry</code> block.</p>
    </td>
  </tr>
</table>



<hr />
<p align="right"><p align="right"><a href="00001142.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00001144.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00001143.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



