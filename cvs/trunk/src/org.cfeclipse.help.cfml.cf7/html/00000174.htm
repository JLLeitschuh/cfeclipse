<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="Content-Style-Type" content="text/css">
   <script src="pages.js" type="text/javascript" language="Javascript1.2" charset="UTF-8"></script>
   <title>Exercise 2: Adding trips with SQL INSERT statements</title>
</head>
<body>
<p align="right"><p align="right"><a href="00000173.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000175.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<hr />
<h1>Exercise 2: Adding trips with SQL INSERT statements</h1>
<p>In <a href="00000166.htm#1141005">Lesson 8: Implementing Browsing and Searching</a>, you built a Trip Edit page to collect the data. Now you can modify the Trip Edit action page to insert the data into the database. There are two approaches to inserting data into a SQL database: </p>
<ul>
<li>
   Build a SQL INSERT statement and execute it using the <code>cfquery</code> tag. 
</li>
<li>
   Use the ColdFusion <code>cfinsert</code> tag. This approach eliminates the need for you to learn SQL syntax.
</li>
</ul>
<p>In this exercise, you use a SQL INSERT statement.</p>
<p>In previous lessons, you used the SQL SELECT statement to retrieve data and the SQL DELETE statement to delete data from the Trips table in the Compass Travel database. To add new trips to the database using SQL, you must understand the syntax of the SQL INSERT statement.</p>
<p>The SQL INSERT statement inserts new rows into a relational table. The SQL INSERT statement has the following format:</p>
<pre>INSERT INTO table_name
VALUES (value1, value2,....)
</pre><p>For example, the database table named Clients contains information about people in the following rows:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
LastName
    </th>
    <th>
FirstName
    </th>
    <th>
Address
    </th>
    <th>
City
    </th>
  </tr>
  <tr>
    <td>
<p>Tom</p>
    </td>
    <td>
<p>Jones</p>
    </td>
    <td>
<p>12 State St</p>
    </td>
    <td>
<p>Boston</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Peter</p>
    </td>
    <td>
<p>Green</p>
    </td>
    <td>
<p>1 Broadway</p>
    </td>
    <td>
<p>New York</p>
    </td>
  </tr>
</table>

<p>To add a record to the table, use the following statement:</p>
<pre>INSERT INTO Clients
VALUES (&#39;Smith&#39;, &#39;Kaleigh&#39;, &#39;14 Greenway&#39;, &#39;Windham&#39;)
</pre><p>After the database management system processes the preceding statement, the table contains the following rows:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
LastName
    </th>
    <th>
FirstName
    </th>
    <th>
Address
    </th>
    <th>
City
    </th>
  </tr>
  <tr>
    <td>
<p>Tom</p>
    </td>
    <td>
<p>Jones</p>
    </td>
    <td>
<p>12 State St</p>
    </td>
    <td>
<p>Boston</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Peter</p>
    </td>
    <td>
<p>Green</p>
    </td>
    <td>
<p>1 Broadway</p>
    </td>
    <td>
<p>New York</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Smith</p>
    </td>
    <td>
<p>Kaleigh</p>
    </td>
    <td>
<p>14 Greenway</p>
    </td>
    <td>
<p>Windham</p>
    </td>
  </tr>
</table>

<p>Notice that the values inserted in the table were surrounded by single-quotation marks in the statement. In SQL, you must surround any text or date values with single-quotation marks; however, you don't use single-quotation marks with numeric values.</p>
<p>Alternatively, you can specify the columns for which you want to insert data. This approach lets you insert data into some columns while omitting others. For this approach, you use the following syntax:</p>
<pre>INSERT INTO table_name (column1, column2,...)
VALUES (value1, value2,....)
</pre><p>For example, to add Kaleigh Smith of Windham, with an unknown address, you use the named column approach:</p>
<pre>INSERT INTO Clients (LastName, FirstName, City)
VALUES (&#39;Smith&#39;, &#39;Kaleigh&#39;, &#39;Windham&#39;)
</pre><p>You use the <code>cfquery</code> tag to execute SQL from ColdFusion. The <code>cfquery</code> tag passes SQL statements to your data source. As described in <a href="00000111.htm#1141005">Lesson 2: Configuring Your Development&#160;Environment</a>, a data source stores information about how to connect to an indicated data provider, such as a relational database management system. The data source that you established in that chapter stored information on how to access the Compass Travel database. The data source name was &quot;CompassTravel.&quot; </p>
<h4>To add data using a SQL INSERT statement and a cfquery tag:</h4>
<ol>
<li>
   Open the tripeditaction.cfm file in the my_app directory.
</li>
<li>
   Locate the <code>&lt;cfif isOk EQ &quot;Yes&quot;&gt;</code> tag near the end of the file. After the <code>&lt;H1&gt;Trip Added<br />&lt;/H1&gt;</code> line, add the following code in the following table to insert the data from the Form variables into the trips table:
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
For 
    </th>
    <th>
Code 
    </th>
  </tr>
  <tr>
    <td>
<p>Windows users, using MS Access</p>
    </td>
    <td>
<pre>&lt;!--- Insert the new trip record into the Compass 
   Travel database. ---&gt;
&lt;cfquery name=&quot;AddTrip&quot; datasource=&quot;compasstravel&quot;&gt;
   INSERT INTO Trips (tripName, eventType, tripDescription, 
      tripLocation,departureDate, returnDate, price, tripLeader,
      photo, baseCost, numberPeople, depositRequired)
   VALUES (&#39;#Form.tripName#&#39;, #Form.eventType#,
      &#39;#Form.tripDescription#&#39;,
      &#39;#Form.tripLocation#&#39;,&#39;#Form.departureDate#&#39;,
      &#39;#Form.returnDate#&#39;,
      #Form.price#, &#39;#Form.tripLeader#&#39;, &#39;#Form.photo#&#39;,
      #Form.baseCost#, #Form.numberPeople#, &#39;#Form.depositRequired#&#39;)
&lt;/cfquery&gt;
</pre>    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>UNIX users, using PointBase</p>
    </td>
    <td>
<pre>&lt;!--- Insert the new trip record into the 
   Compass Travel database. ---&gt;
&lt;!--- Use local variables to convert dates to JDBC format
   (yyyy-mm-dd) from input format (mm/dd/yyyy). ---&gt;
&lt;cfset JDBCdepartureDate = #Right(Form.departureDate,4)# 
   &amp; &quot;-&quot; &amp; #Left(Form.departureDate,2)# &amp; &quot;-&quot; 
   &amp; #Mid(Form.departureDate,4,2)#&gt; 
&lt;cfset JDBCreturnDate = #Right(Form.returnDate,4)# &amp; &quot;-&quot; 
   &amp; #Left(Form.returnDate,2)# &amp; &quot;-&quot; 
   &amp; #Mid(Form.returnDate,4,2)#&gt; 
&lt;cfquery name=&quot;AddTrip&quot; datasource=&quot;CompassTravel&quot;&gt;
   INSERT INTO Trips (tripName, eventType, 
   tripDescription, tripLocation, 
      departureDate, returnDate, price, tripLeader, photo,
      baseCost, numberPeople,   depositRequired)
  VALUES (&#39;#Form.tripName#&#39;, #Form.eventType#, &#39;#Form.tripDescription#&#39;,
      &#39;#Form.tripLocation#&#39;, Date&#39;#JDBCdepartureDate#&#39;,
      Date&#39;#JDBCreturnDate#&#39;,
      #Form.price#,&#39;#Form.tripLeader#&#39;, &#39;#Form.photo#&#39;,
      #Form.baseCost#, #Form.numberPeople#, &#39;#Form.depositRequired#&#39;)
&lt;/cfquery&gt;
</pre>    </td>
  </tr>
</table>

</li>
<li>
   Save the file.
</li>
</ol>
<h4>To test the modified code:</h4>
<ol>
<li>
   Open the tripedit.cfm page in your browser.
</li>
<li>
   In the tripedit.cfm page, enter in the fields the values in the following table, and then click Save.
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Field
    </th>
    <th>
Value
    </th>
  </tr>
  <tr>
    <td>
<p>Trip Name</p>
    </td>
    <td>
<p>NH White Mountains</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Event Type</p>
    </td>
    <td>
<p>Mountain Climbing</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Trip Description</p>
    </td>
    <td>
<p>Climb the 5 highest peaks in the New Hampshire White Mountains.</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Trip Location</p>
    </td>
    <td>
<p>Northeastern New Hampshire</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Departs</p>
    </td>
    <td>
<p>05/01/2005</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Returns</p>
    </td>
    <td>
<p>05/10/2005</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Number of People</p>
    </td>
    <td>
<p>15</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Price</p>
    </td>
    <td>
<p>1200</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Base Cost</p>
    </td>
    <td>
<p>600</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Deposit Required</p>
    </td>
    <td>
<p>Yes</p>
    </td>
  </tr>
  <tr>
    <td>
<p>Trip Leader</p>
    </td>
    <td>
<p>Tom Finn</p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<p>Photo File Name</p>
    </td>
    <td>
<p>whitemountains.jpg</p>
    </td>
  </tr>
</table>

<p>After the new trip is written to the database, the following message appears: You have added NH White Mountains to the trips database.</p>
</li>
<li>
   To verify that the trip was saved, open the tripsearchform.cfm page in the my_app directory in your browser.
</li>
<li>
   In the Trip Search page, in the Trip Location drop-down list, select the Begins With option, and enter the value <strong>Nor</strong> in the text box.
</li>
<li>
   Click Search.
<p>The TripResults page appears.</p>
</li>
<li>
   Click NH White Mountains to display the details of the trip you just added. Verify that all the fields were saved correctly. 
</li>
<li>
   Click the Delete button to delete this record so that you can reuse some of the steps of this exercise in <a href="00000175.htm#1152778">Exercise 3: Adding data using the cfinsert tag</a>.
</li>
</ol>
<h4><a name="wp1155748"></a>Reviewing the code</h4>
<p>The following table describes the SQL INSERT and <code>cfquery</code> code that ColdFusion uses to add data:</p>
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <th>
Code 
    </th>
    <th>
Explanation
    </th>
  </tr>
  <tr>
    <td>
<pre>&lt;cfquery name=&quot;AddTrip&quot;<br />datasource=&quot;CompassTravel&quot;&gt;
</pre>    </td>
    <td>
<p>Using the <code>datasource</code> attribute, the <code>cfquery</code> tag connects to the CompassTravel data source and returns a result set identified by the <code>name</code> attribute. </p>
    </td>
  </tr>
  <tr bgcolor="#F8F8F8">
    <td>
<pre>INSERT INTO Trips (TripName,<br />EventType, tripDescription,<br />tripLocation, departureDate,<br />returnDate, price, tripLeader,photo,<br />baseCost, numberPeople,<br />depositRequired)
  VALUES ( &#39;#Form.TripName#&#39;,<br />#Form.EventType#,<br />&#39;#Form.tripDescription#&#39;,<br />&#39;#Form.tripLocation#&#39;,<br />&#39;#Form.departureDate#&#39;,<br />&#39;#Form.returnDate#&#39;, #Form.price#,<br />&#39;#Form.tripLeader#&#39;, &#39;#Form.photo#&#39;,<br />#Form.baseCost#, Form.numberPeople#,<br />&#39;#Form.depositRequired#)
</pre>    </td>
    <td>
<p>The SQL INSERT statement identifies the data to insert into the Trips table. The table column names are cited in a comma-separated list surrounded by parentheses <code>(TripName, EventType....)</code> after the table name Trips. </p>
<p>The <code>VALUES</code> keyword indicates the list of values that are inserted into the columns in the same order as the columns are specified earlier in the statement. </p>
<p>The values refer to form variables that are passed from the data entry form to the action page. The variables are surrounded by number signs; for example, <code>#Form.baseCost#</code>. Also, if the column data type is a String data type, the values are surrounded by single-quotation marks; for example: <code>&#39;#Form.TripName#&#39;</code>.</p>
    </td>
  </tr>
</table>

<p>For more information about adding data to a database using SQL and the <code>cfquery</code> tag, see <i>ColdFusion MX Developer's Guide</i>. For more information about SQL, consult any SQL primer.</p>


<hr />
<p align="right"><p align="right"><a href="00000173.htm"><img src="images/previous.gif" width="9" height="14" border="0" alt="Previous"></a>&nbsp;&nbsp;<a href="00000175.htm"><img src="images/next.gif" width="9" height="14" border="0" alt="Next"></a>
</p></p>
<p><a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000174.htm" target="mm_window">View comments in LiveDocs</a></p>
 </body>
</html>



